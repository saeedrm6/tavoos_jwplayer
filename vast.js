!function () { function d(e) { return (d = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (a) { return typeof a } : function (a) { return a && "function" == typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a })(e) } function m(a, e) { if (!(a instanceof e)) throw new TypeError("Cannot call a class as a function") } function l(a, e) { for (var t, d = 0; d < e.length; d++)t = e[d], t.enumerable = t.enumerable || !1, t.configurable = !0, "value" in t && (t.writable = !0), Object.defineProperty(a, t.key, t) } function t(a, e, t) { return e && l(a.prototype, e), t && l(a, t), a } function g(a, e, t) { return e in a ? Object.defineProperty(a, e, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : a[e] = t, a } function y() { return (y = Object.assign || function (a) { for (var e, d = 1; d < arguments.length; d++)for (var n in e = arguments[d], e) Object.prototype.hasOwnProperty.call(e, n) && (a[n] = e[n]); return a }).apply(this, arguments) } function p(a) { return function (a) { if (Array.isArray(a)) { for (var e = 0, r = Array(a.length); e < a.length; e++)r[e] = a[e]; return r } }(a) || function (a) { if (Symbol.iterator in Object(a) || "[object Arguments]" === Object.prototype.toString.call(a)) return Array.from(a) }(a) || function () { throw new TypeError("Invalid attempt to spread non-iterable instance") }() } function r(a) { var e = a.match(J); return e && 1 < e.length ? e[1] : "" } function f() { var a, d, n = null === document.referrer.match(Z) ? "" : (a = document.referrer, (d = a.match(G)) && 1 < d.length ? "".concat(d[1]).concat(d[2]) : a); if (window.top !== window.self) { try { return { url: window.top.location.href, domain: window.top.document.domain, referrer: n } } catch (a) { } return { url: n, domain: r(n), referrer: "" } } return { url: document.location.href, domain: document.domain, referrer: n } } function c(a) { var e = a.advertising; if (e && e.placement) { var t = e.placement.toLowerCase(); if (U[t]) return U[t] } return U[e && e.outstream ? "article" : "instream"] } function v(d, s) { var t, e = d.getPlugin("inference"), r = s.jwpseg_client_side, n = s.jwpseg || []; if (!r || !r.length || !e) return n; try { t = e.predict(r, s) } catch (a) { return s.jwpseg || [] } var a = Object.keys(t).filter(function (a) { return t[a] }), o = n.filter(function (a) { return -1 === r.indexOf(a) }); return [].concat(p(a), p(o)) } function u(a, e, t, d) { var r = k(a, t, d), i = e.adErrorCode || 60900; return y(r, { message: e.message, code: 100 <= e.code && 1008 >= e.code ? e.code : 900, adErrorCode: i }), 10402 === i || 50004 === i || 50400 === i ? r.timeout = t ? t.creativeTimeout : d.creativeTimeout : 11007 !== i && 10301 !== i && 60006 !== i || (r.timeout = t ? t.requestTimeout : d.requestTimeout), void 0 !== e.id && (r.id = e.id), void 0 !== e.sourceError && (r.sourceError = e.sourceError), void 0 !== e.tag && (r.tag = e.tag), void 0 !== e.vmap && (r.vmap = e.vmap), r } function k(a) { var e = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : null, t = 2 < arguments.length && void 0 !== arguments[2] ? arguments[2] : {}, i = { client: "vast" }; if (null === a) return i; a.isDestroyed() || (i.placement = c(a.player.getConfig())); var r = t.schedule; if (r) return y(i, { item: a.item, tag: r.getVMAP(), adbreaks: r.getAllAds().map(function (e) { var t = { type: e._type, offset: e._offSet }; e._vmap ? t.vmap = e._vmap : t.adbreak = y({}, e._adbreak); var d = a.bidsResult[e.adBreakId]; return d && y(t, d.getEventObject()), t }) }); if (a.config.preloadAds && (i.preloadAds = t.preload || e && e._preload || !1), t.jwpseg && (i.jwpseg = t.jwpseg), e) { var n = a.getAdIds(e, t), s = n.adBreakId; y(i, { adBreakId: s, adPlayId: n.adPlayId, offset: e._offSet }); var o = a.bidsResult[s]; o && y(i, o.getEventObject()) } var d = e && (t.tag || e._currentTag); return d && (y(i, { id: e._id, tag: d, adposition: e._position, sequence: e._adPodIndex + 1, witem: e._waterfallIndex + 1, wcount: e._adQueue ? e._adQueue.length : 1, adsystem: e.adsystem || "" }), e.adServingId && (i.adServingId = e.adServingId), void 0 !== e.skipoffset && (i.skipoffset = e.skipoffset), e.wrappedTags && y(i, { wrapperAdSystem: e.wrapper || "", wrappedTags: e.wrappedTags.slice(1) }), e._adbreak && (i.adschedule = e._adbreak, i.adschedule.offset = e._offSet)), e && e.companions && t.companions ? (i.companions = t.companions, i) : (e && e.response ? (y(i, { adtitle: e.adTitle || "", description: e.description || "", adId: e.adId || "", creativeId: e.creativeId || "", creativeAdId: e.creativeAdId || "", request: e.request, response: e.response, conditionalAd: e.conditionalAd, conditionalAdOptOut: a.params.conditionaladoptout, vastversion: e.vastversion, clickThroughUrl: e.clickthrough, duration: t.duration, linear: t.linear }), "boolean" == typeof e.mediaFileCompliance && (i.mediaFileCompliance = e.mediaFileCompliance, e.nonComplianceReasons && (i.nonComplianceReasons = e.nonComplianceReasons)), e.selectedMedia && (i.mediafile = { file: e.selectedMedia.file }), t.metadata && (i.adMessage = a.params.dynamicMessage || "", e.companions && (i.companions = e.companions), e.sequence && (i.podMessage = a.params.podMessage || ""), void 0 !== e.skipoffset && y(i, { skipMessage: a.params.skipMessage, skipText: a.params.skipText }))) : i.item = a.item, i) } function h(a) { return a.isBeforePlay() || 0 === a.getPosition() && "idle" === a.getState() ? "pre" : a.isBeforeComplete() || a.getPosition() === a.getDuration() ? "post" : "mid" } function s(a) { return function (a) { return "application/javascript" === a.type || "application/x-javascript" === a.type }(a) ? "html5" : "flash" } function A(a) { for (var e, d, n = 0; n < a.media.length; n++)if (d = a.media[n], "html5" === s(d)) { e = d; break } return e } function P(a, e, t, d) { a.tracker = new de(a, a.trackers, e, t, d) } function b(a) { a && a.iconInstances && (a.iconInstances.forEach(function (a) { a.remove() }), a.iconInstances = null) } function i(a, e, t) { var d = document.createElement("param"); d.setAttribute("name", e), d.setAttribute("value", t), a.appendChild(d) } function _(m, g, t, i) { var r = 4 < arguments.length && void 0 !== arguments[4] ? arguments[4] : {}; if (!m) return Promise.resolve(m); var n = function (d, e) { var t = d.getConfig(), i = d.getPlaylistItem() === e; return { playerHeight: d.getHeight() || t.height || "", playerWidth: d.getWidth() || t.width || "", itemDuration: i ? (r = d.getDuration(), o = 3, l = Math.pow(10, o), Math.round(r * l) / l || "") : "", item: e, jwpseg: v(d, e), placement: c(t), userAgent: navigator.userAgent }; var r, o, l }(g, t), a = f(); -1 !== m.indexOf("__jwpseg__") && (r.jwpseg = n.jwpseg), m = w(m, "__random-number__", Math.random() * Math.pow(10, 18)), m = w(m, "__timestamp__", new Date().getTime()), m = w(m, "__page-url__", encodeURIComponent(a.url)), m = w(m, "__referrer__", encodeURIComponent(a.referrer)), m = w(m, "__player-height__", n.playerHeight), m = w(m, "__player-width__", n.playerWidth), m = w(m, "__item-duration__", n.itemDuration), m = w(m, "__jwpseg__", n.jwpseg), m = w(m, "__domain__", encodeURIComponent(a.domain)), m = w(m, "__placement__", n.placement), m = w(m, "__device-ua__", encodeURIComponent(n.userAgent)); for (var s = (m = i.companion ? w(m, "__companion-div__", i.companion.id) : w(m, "__companion-div__", "")).match(new RegExp(/__item-[a-z 0-9 A-Z]*__/g)), o = 0; s && o < s.length; o++) { var y = s[o], d = y.substring(7, y.length - 2); if (t.hasOwnProperty(d) && "string" == typeof t[d]) { var u = t[d]; 1e3 < u.length && (u = u.substring(0, 1e3)), m = w(m, y, encodeURIComponent(u)) } else m = w(m, y, "") } var h = g.getConfig().autostart ? 1 : 0, p = g.getMute() ? 1 : 0; return -1 !== (m = function (a, r, t) { return fe.test(a) && (a = "".concat(a, "&vpa=").concat(r, "&vpmute=").concat(t)), a }(m, h, p)).indexOf("__gdpr__") || -1 !== m.indexOf("__gdpr_consent__") ? be().then(function (e) { var a = e.gdprApplies, t = e.consentData; return m = w(m, "__gdpr__", a ? 1 : 0), w(m, "__gdpr_consent__", t) }).catch(function () { return m }) : Promise.resolve(m) } function w(a, e, t) { return a.replace(e, t) } function T(a, e, t) { a.push({ message: e, code: 1002, adErrorCode: 11002, id: t }) } function I() { var a = new Error("No AdBreaks in VMAP"); throw a.adErrorCode = 60005, a } function E(a, e, t) { var d = []; return a && (d = a.getElementsByTagName(e), t && d && 0 === d.length && (d = a.getElementsByTagName("".concat(t, ":").concat(e)))), d } function C(a, e) { if (a) { var t = a.getElementsByTagName(e); if (t) return t[0] } return null } function n(a, e, t, d) { var r = []; return a || e ? r = e.getElementsByTagNameNS ? e.getElementsByTagNameNS(a, t) : e.getElementsByTagName("".concat(d, ":").concat(t)) : r } function S(a, e) { return a ? a.getAttribute(e) : null } function R(a, e) { var t = S(e, "event"); if ("progress" === t) { var d = S(e, "offset"); t = "".concat(t, "_").concat(d) } j(a, t, x(e)) } function x(a) { if (a) { var e = a.textContent || a.text; if (e) return ne(e) } return "" } function j(a, e, t) { a[e] || (a[e] = []), t && (a[e].push(t), Ee(t)) } function L(a, d, t) { var e = E(a, d); we.call(e, function (a) { j(t, d.toLowerCase(), x(a)) }) } function M(a) { a.onload = a.onreadystatechange = a.onerror = null, "abort" in a && a.abort() } function V(a, e, t) { var d; if (null !== a) return Object.keys(a).forEach(function (e) { var t = a[e]; (d = d || {})[e] = "_adQueue" === e || "_pod" === e ? t.slice() : t }), d ? (d.requestTimeout = e, d.creativeTimeout = t, d._errors = [], d._waterfallIndex = 0, d._adPodIndex = 0, d) : void 0 } function B(a, e) { return "%" === a.toString().slice(-1) ? e * parseFloat(a.slice(0, -1)) / 100 : parseFloat(a) } function O(a) { return Array.isArray(a) ? a.slice(0) : [a] } function H(a, e) { return 0 === a ? 1 / 0 : a || e } function q(d, o) { var e = (d || []).filter(function (a) { var e = a.min, t = a.max; return o >= (e || 0) && o <= (t || 1 / 0) })[0]; if (e) { var t = e.min ? Math.floor(100 * e.min) : 0, r = Math.floor(100 * o), i = .01 <= e.increment ? Math.floor(100 * e.increment) : 1; return (t + Math.floor((r - t) / i) * i) / 100 } return parseFloat(o) } function D(a, e, t) { var d = 3 < arguments.length && void 0 !== arguments[3] ? arguments[3] : {}, r = a.createElement(e); return r.appendChild(a.createCDATASection(t)), Object.keys(d).forEach(function (a) { r.setAttribute(a, d[a]) }), r } function N(a) { if ("start" === a || "0%" === a || !a || "pre" === a || "00:00:00" === a) return 0; if ("end" === a || "100%" === a || "post" === a) return -2; if ("string" == typeof a && 0 <= a.indexOf("%")) return -1; var e = parseInt(a); return 0 <= e ? e : -1 } function X(a, e) { return new e.scriptloader(a, !1, 3500).load().catch(function () { return Promise.reject({ message: "Error loading script" }) }) } function Q(a) { return a.outerHTML || new XMLSerializer().serializeToString(a) } function z(a) { return null === na && (na = Promise.resolve(window.apstag).then(function (e) { return e && e.init && e.fetchBids ? e : X(["file" === document.location.protocol ? "https:" : "", "//c.amazon-adsystem.com/aax2/apstag.js"].join(""), a).then(function () { return window.apstag }) }).catch(function (a) { throw na = null, a })), na } function Y(d, e) { if (null === sa) { var t = ta(), i = oa || window.SpotX; if (i && i.DirectAdOS) return sa = Promise.resolve({ SpotX: i, loadingTime: 0 }); var r = ["file" === document.location.protocol ? "https:" : "", "//js.spotx.tv/directsdk/v1/", d, ".js"].join(""); (sa = "function" == typeof require ? (n = r, new Promise(function (a, e) { setTimeout(e, 3500), require([n], a, e) }).catch(function () { return Promise.reject({ message: "Error loading script" }) })).then(function (a) { return { SpotX: oa = a, loadingTime: ta() - t } }).catch(function () { return ae(r, t, e) }) : ae(r, t, e)).catch(function () { sa = null }) } var n; return sa } function ae(a, e, t) { return X(a, t).then(function () { return { SpotX: window.SpotX, loadingTime: ta() - e } }) } function se(a, e) { return null === la && (la = Promise.resolve(window.indexapi).then(function (t) { return t || X(["file" === document.location.protocol ? "https:" : "", a || "//js-sec.indexww.com/htv/htv-jwplayer.min.js"].join(""), e).then(function () { return window.indexapi }) }).catch(function (a) { throw la = null, a })), la } var le, pe, ce, me, ge, ye, he = ["adImpression", "adError", "adPodError"], F = ["adStarted", "adComplete", "adImpression", "adClick", "adSkipped", "adError", "adPlay", "adPause", "adMeta"], U = (g(le = {}, ["instream"], 1), g(le, ["banner"], 2), g(le, ["article"], 3), g(le, ["feed"], 4), g(le, ["floating"], 5), g(le, ["interstitial"], 5), g(le, ["slider"], 5), le), W = function () { function a(e, t, r, d, i) { var n = this; m(this, a), this.player = e, this.state = e.state, this.vpaidURL = r, this.adTag = d, this.adParams = i.adParams, this.vpaidControls = i.vpaidControls, this.remainingTimeInterval = null, this.type = "vpaid", this.instream = t || e.createInstream(), this.vpaidState = { linear: !1, expanded: !1, remainingTime: -1 }, this.paused = !1, y(this, e.Events), this.setMuteCallback = function () { n.handleMute ? n.setMute() : n.handleMute = !0 }, this.playerContainer = this.player.getContainer(), i.adOptOut ? setTimeout(function () { n.sendEvent("error", { message: "Conditional ad rejected", code: 408 }) }, 0) : this.iframe = function (d, e, t, i) { var r = document.createElement("iframe"); r.setAttribute("allow", "autoplay"), r.src = "javascript:false", r.classList.add("jw-vpaid-iframe"), r.scrolling = "no", t.querySelector(".jw-media").appendChild(r); var n = r.contentWindow.document; return n.open().write("\n    <body onload=\"\n        var js = document.createElement('script');\n        js.src = '".concat(e, "';\n        js.addEventListener('load', function() { window.myCallback(); });\n        document.body.appendChild(js);\"\n    style=\"margin: 0\">")), r.contentWindow.myCallback = i, n.close(), r }(e.utils, this.vpaidURL, this.playerContainer, this.callback.bind(this)) } return t(a, [{ key: "sendEvent", value: function (a, e) { (e = e || {}).tag || (e.tag = this.adTag), this.trigger(a, e) } }, { key: "sendTimeEvent", value: function (a, e, t) { var d = e.getAdDuration(), r = e.getAdRemainingTime(), i = y({ duration: d }, t); this.sendEvent(a, i), 0 < r && (i.position = d - r, this.trigger("time", i)) } }, { key: "handleQuartile", value: function (a, e) { this.sendTimeEvent("quartile", a, { quartile: e }) } }, { key: "genEvent", value: function (a) { var e = this; return function (t) { e.on(a, t) } } }, { key: "setMute", value: function () { var a = 0 === this.vpaidAd.getAdVolume(); this.player.getMute() !== a && this.player.setMute(a) } }, { key: "prepareNonlinearAd", value: function () { if (this.player.utils.style(this.iframe, { height: 150 }), this.iframe.classList.add("jw-vpaid-non-linear"), this.resize(null, 150), this.instream) { this.instream.noResume = !0, this.instream.applyProviderListeners(null), this.instream.destroy(), this.instream = null; var a = this.playerContainer.querySelector(".jw-media"), e = a.querySelector("video,audio"); a.insertBefore(e, this.iframe), e.play() } } }, { key: "progressInterval", value: function (a) { var e = this; if (clearInterval(this.remainingTimeInterval), a && a.getAdRemainingTime) { var t = -1; this.remainingTimeInterval = setInterval(function () { if (!e.paused) { var d = a.getAdRemainingTime(); isNaN(d) || 0 >= d || t === d || (t = d, e.sendTimeEvent("remainingTimeChange", a, { remainingTime: d })) } }, 250) } } }, { key: "genListeners", value: function (a) { var d = this; return { AdLoaded: function () { a.setAdVolume(d.getPlayerVolume()), a.startAd() }, AdStarted: function () { var e = a.getAdDuration ? a.getAdDuration() : 0, t = !a.getAdLinear || a.getAdLinear(), r = t ? "linear" : "nonlinear"; t ? (d.vpaidControls || (d.instream = d.instream || d.player.createInstream(), d.instream.hide()), d.progressInterval(a)) : d.prepareNonlinearAd(), d.sendEvent("impression", { linear: r, duration: e }), d.sendEvent("play", { oldstate: "buffering", newstate: "playing", linear: r }), d.handleMute = !0, a.subscribe(d.setMuteCallback, "AdVolumeChange", a) }, AdVideoStart: function () { d.sendEvent("started") }, AdStopped: function () { d.sendEvent("stopped") }, AdPaused: function () { d.paused || (d.paused = !0, d.sendEvent("pause", { newstate: "paused", oldstate: "playing" })) }, AdPlaying: function () { if (d.paused) { var e = !a.getAdLinear || a.getAdLinear() ? "linear" : "nonlinear"; d.paused = !1, d.sendEvent("play", { newstate: "playing", oldstate: "paused", linear: e }) } }, AdLinearChange: function () { !a.getAdLinear || a.getAdLinear() ? (d.player.utils.style(d.iframe, { height: "100%" }), d.player.off(null, null, d), d.instream = d.instream || d.player.createInstream(), d.instream.init(), d.vpaidControls || d.instream.hide()) : d.prepareNonlinearAd() }, AdDurationChange: function () { d.sendTimeEvent("remainingTimeChange", a, { isDurationChange: !0, remainingTime: a.getAdRemainingTime() }) }, AdRemainingTimeChange: function () { d.paused || d.sendTimeEvent("remainingTimeChange", a, { remainingTime: a.getAdRemainingTime() }) }, AdExpandedChange: function () { d.sendEvent("expandedChange", { expanded: a.getAdExpanded() }) }, AdSkippableStateChange: function () { d.sendEvent("skippableStateChange", { skippable: a.getAdSkippableState() }) }, AdSkipped: function () { d.sendEvent("skipped") }, AdVideoFirstQuartile: function () { d.handleQuartile(a, 1) }, AdVideoMidpoint: function () { d.handleQuartile(a, 2) }, AdVideoThirdQuartile: function () { d.handleQuartile(a, 3) }, AdVideoComplete: function () { d.sendEvent("complete") }, AdUserClose: function () { d.sendEvent("close") }, AdClickThru: function (a, e, t) { d.sendEvent("click", { id: e, url: a, playerHandles: t }) }, AdError: function (a) { var e = function (a) { if (a) { var e = a.match(/\b(?:[34])[0-9]{2}\b/); if (e) return parseInt(e[0], 10); if (a.match(/timeout/i)) return a.match(/vpaid|vast/i) ? 301 : 402; if (a.match(/found/i)) return 401; if (a.match(/supported/i)) return 403; if (a.match(/(?:displaying|media file)/i)) return 405 } return 901 }(a); d.sendEvent("error", { message: a, code: e, adErrorCode: 5e4 + e }) } } } }, { key: "callback", value: function () { try { this.vpaidAd = this.iframe.contentWindow.getVPAIDAd(); var d = this.vpaidAd.handshakeVersion("2.0"); if (1 > parseFloat(d)) throw new Error("Invalid vpaid version in handshake") } catch (a) { return void this.sendEvent("error", { message: a.message || "VPAID general error", code: 901, adErrorCode: 51901 }) } var o = this.vpaidAd, t = this.genListeners(o); Object.keys(t).forEach(function (a) { o.subscribe(t[a], a, o) }), this.listeners = t; var e = { AdParameters: this.adParams }, r = this.iframe.contentWindow.document.createElement("div"); r.className = "jw-vpaid-wrapper", r.style.height = "100%", this.iframe.contentWindow.document.body.appendChild(r), 0 <= this.vpaidURL.indexOf("//imasdk.googleapis.com/js/sdkloader/vpaid_adapter.js") && (this.iframe.contentWindow.HTMLVideoElement = HTMLVideoElement); var i = { videoSlot: this.instream.getMediaElement(), slot: r }; o.initAd(this.player.getWidth(), this.player.getHeight(), "normal", 1e3, e, i), o.setAdVolume(this.getPlayerVolume()) } }, { key: "play", value: function () { this.vpaidAd.resumeAd() } }, { key: "pause", value: function () { this.vpaidAd.pauseAd() } }, { key: "skip", value: function () { return this.vpaidAd.skipAd && this.vpaidAd.getAdSkippableState() && (this.vpaidAd.skipAd(), !0) } }, { key: "stop", value: function () { if (this.vpaidAd) try { this.vpaidAd.stopAd() } catch (a) { } } }, { key: "getPlayerVolume", value: function () { return this.player.getMute() ? 0 : this.player.getVolume() / 100 } }, { key: "setVolume", value: function (a) { this.handleMute = !1, this.vpaidAd.setAdVolume(a / 100) } }, { key: "resize", value: function (a, e) { if (this.vpaidAd && this.vpaidAd.resizeAd) { var t = this.player.getFullscreen() || document.fullScreen || document.mozFullScreen || document.webkitIsFullScreen ? "fullscreen" : "normal"; this.vpaidAd.resizeAd(a || this.player.getWidth(), e || this.player.getHeight(), t) } } }, { key: "destroy", value: function () { if (this.removeEvents(), clearInterval(this.remainingTimeInterval), this.vpaidAd) try { var a = this.listeners, e = this.vpaidAd; Object.keys(a).forEach(function (t) { e.unsubscribe(a[t], t, e) }), e.unsubscribe(this.setMuteCallback, "AdVolumeChange", e) } catch (a) { } this.iframe && this.iframe.parentNode && this.iframe.parentNode.removeChild(this.iframe), this.vpaidAd = null, this.player = null, this.instream = null } }, { key: "removeEvents", value: function () { this.player && this.player.off(null, null, this), this.off() } }, { key: "attachMedia", value: function () { } }, { key: "detachMedia", value: function () { } }, { key: "volume", value: function () { } }, { key: "mute", value: function () { } }, { key: "getState", value: function () { return this.vpaidState.linear ? this.paused ? "paused" : "playing" : "idle" } }]), a }(), $ = function (p) { var e = K("".concat(p, "Locator")); return null !== e && function (t, i, c, a) { var s = re(); window.addEventListener("message", function e(a) { var t = a ? a.data : {}; if ("string" == typeof t) try { t = JSON.parse(t) } catch (a) { t = {} } var d = "".concat(p, "Return"); t[d] && t[d].callId === s && (removeEventListener("message", e), c(t[d].returnValue, t[d].success)) }, !1); var r = void 0 === a ? "parameter" : "version", n = g({}, ["".concat(p, "Call")], g({ command: t, callId: s, parameter: a }, [r], i)); e.postMessage(JSON.stringify(n), "*") } }, G = /^(https?:\/\/).*.(?:ampproject.org|bing-amp.com)\/(?:.\/)*(.*)\/amp.*$/, J = new RegExp(/^[^/]*:\/\/\/?([^\/]*)/), K = function (a) { for (var e = window; e;) { try { if (e.frames[a]) break } catch (a) { } e = e === window.top ? null : e.parent } return e }, Z = new RegExp(/^[^:\/?#]+:?\/\/[^\/?#]+/), ee = null, ke = { gdprApplies: !0, consentData: "" }, be = function () { var a = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : 1e3; return null === ee && (ee = new Promise(function (a) { var e = window.__tcfapi || $("__tcfapi"); if (e) return e("getTCData", 2, function (e, t) { a(!1 === t ? null : { gdprApplies: e.gdprApplies, consentData: e.tcString }) }, null); var t = window.__cmp || $("__cmp"); return t ? t("getConsentData", null, function (e, t) { a(!1 === t ? null : { gdprApplies: e.gdprApplies || e.isUserInEu, consentData: e.consentData }) }) : a({ gdprApplies: !1, consentData: "" }) }).then(function (a) { return a && (ke = a), ke })), Promise.race([ee, new Promise(function (e) { setTimeout(e, a, ke) })]) }, re = Date.now || function () { return new Date().getTime() }, ne = function (a) { return a.replace(/^\s+|\s+$/g, "") }, oe = [], de = function () { function d(e, t, r, n, a) { var s = this; m(this, d); var o = t || {}; this.ad = e, this.map = o, this.debugTrackFn = r, this.trackerPlayerUtils = function (a) { return { getPosition: function () { return a.getPosition() }, getFile: function () { return a.getPlaylistItem().file }, getPlacement: function () { return c(a.getConfig()) }, getUserAgent: function () { return navigator.userAgent } } }(n), this.trackingFilter = a, this.lastQuartile = 0, this.progressEvents = [], this.breakStarted = !1, this.started = !1, this.firedError = !1, this.hasComp = !1, Object.keys(o).forEach(function (a) { if (o.hasOwnProperty(a) && 0 === a.indexOf("progress")) { var e = "".concat(a.split("_")[1]), t = { key: a, offset: e, tracked: !1, percentage: !1 }; /^\d+%$/.test(e) ? (t.percentage = !0, t.offset = parseFloat(e)) : t.offset = n.utils.seconds(e), s.progressEvents.push(t) } }), this.setFactories() } return t(d, [{ key: "getUrls", value: function (a) { return this.map.hasOwnProperty(a) ? this.map[a] : [] } }, { key: "addUrl", value: function (a, e) { this.map.hasOwnProperty(a) ? this.map[a].push(e) : (this.map[a] = [], this.map[a].push(e)) } }, { key: "trackPings", value: function (d) { var l = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : {}, e = this.getUrls(d), p = this.trackingFilter, r = [], n = [], a = []; if (e.length) { l = this.replaceMacros(l), e.forEach(function (t) { if (t) { if (Object.keys(l).forEach(function (e) { t = t.replace(e, l[e]) }), p && !1 === p(t)) return void n.push(t); var d = new Image; d.src = t, r.push(t), a.push(d) } }), Array.prototype.push.apply(oe, a); for (var i = oe.length; i-- && (oe[i].width || oe[i].complete);)oe.length = i } "function" == typeof this.debugTrackFn && this.debugTrackFn({ type: "ping", data: { pingType: d, urls: r, filteredUrls: n, images: a } }) } }, { key: "replaceMacros", value: function (p) { var e, c, m, g, y, v, h, k = ke, l = k.gdprApplies, d = k.consentData; return p["[ADSERVINGID]"] = encodeURIComponent(this.ad.adServingId || ""), p["[ASSETURI]"] = encodeURIComponent(this.trackerPlayerUtils.getFile()), p["[CACHEBUSTING]"] = Math.random().toString().slice(2, 10), p["[CONTENTPLAYHEAD]"] = encodeURIComponent((e = this.trackerPlayerUtils.getPosition(), c = ("0" + Math.floor(e / 3600)).slice(-2), m = ("0" + Math.floor((e - 3600 * c) / 60)).slice(-2), c + ":" + m + ":" + ("0" + Math.floor(e - 3600 * c - 60 * m)).slice(-2) + "." + (e % 1).toFixed(3).toString().slice(2, 5))), p["[DEVICEUA]"] = encodeURIComponent(this.trackerPlayerUtils.getUserAgent()), p["[GDPRCONSENT]"] = d, p["[PAGEURL]"] = encodeURIComponent(f().url), p["[PLACEMENTTYPE]"] = this.trackerPlayerUtils.getPlacement(), p["[REGULATIONS]"] = l ? "gdpr" : "", p["[TIMESTAMP]"] = encodeURIComponent((g = new Date, y = g.getTime(), v = g.getTimezoneOffset() / 60, h = 6e4 * g.getTimezoneOffset(), new Date(y - h).toISOString().slice(0, -1) + (0 < v ? "-" : "+") + ("0" + v).slice(-2))), p } }, { key: "start", value: function () { this.started = !0, this.trackPings("start") } }, { key: "breakStart", value: function () { this.breakStarted = !0, this.trackPings("breakStart") } }, { key: "time", value: function (a, e) { if (!(1 >= e)) { for (; (0 | (4 * a + .05) / e) > this.lastQuartile && 3 > this.lastQuartile;)this.lastQuartile++ , 1 === this.lastQuartile ? this.trackPings("firstQuartile") : 2 === this.lastQuartile ? this.trackPings("midpoint") : 3 === this.lastQuartile && this.trackPings("thirdQuartile"); this.trackProgress(a, e) } } }, { key: "trackProgress", value: function (a, e) { for (var t, d = this.progressEvents.length; d--;)if (t = this.progressEvents[d], !t.tracked) { var o = t.offset; t.percentage && (o = e * o / 100), a >= o && (t.tracked = !0, this.trackPings(t.key)) } } }, { key: "error", value: function () { var a = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : 900; this.firedError = !0; var e = {}; e["[ERRORCODE]"] = a, this.trackPings("error", e) } }, { key: "factory", value: function (a) { var e = this; return function () { e.trackPings(a) } } }, { key: "setFactories", value: function () { this.creativeView = this.factory("creativeView"), this.click = this.factory("click"), this.skip = this.factory("skip"), this.complete = this.factory("complete"), this.pause = this.factory("pause"), this.resume = this.factory("resume"), this.mute = this.factory("mute"), this.unmute = this.factory("unmute"), this.fullscreen = this.factory("fullscreen"), this.expand = this.factory("expand"), this.collapse = this.factory("collapse"), this.acceptInvitation = this.factory("acceptInvitation"), this.close = this.factory("close"), this.rewind = this.factory("rewind"), this.impression = this.factory("impression"), this.breakEnd = this.factory("breakEnd") } }]), d }(), ue = function () { function d(e, t, r) { m(this, d), this.player = e, this.icon = t, this.div = r; var i = this.utils = e.utils; this.images = [], this.iconContainer = function (a, e) { var t = document.createElement("div"); return t.className = "jw-ad-icon-container", e.style(t, a), t }(t.style, i); var a = function (a, e) { var t, d = a.resourceSource, r = a.resourceType; return "iframe" === r ? ((t = document.createElement("iframe")).src = d, t.scrolling = "no") : "html" === r ? (t = document.createElement("div"), e.replaceInnerHtml(t, d)) : ((t = document.createElement("img")).src = d, t.setAttribute("type", r)), e.addClass(t, "jw-ad-icon"), t }(t.resource, i); this.iconContainer.appendChild(a), r.appendChild(this.iconContainer); var n = 1e3 * i.seconds(t.offset); 0 < n ? this.showTimeout = setTimeout(this.show.bind(this), n) : this.show(), this.ui = new i.UI(this.iconContainer).on("click tap", this.clickHandler, this) } return t(d, [{ key: "clickHandler", value: function () { this.player.pause({ reason: "clickthrough" }), this.sendPing(this.icon.trackers.iconClick), this.utils.openLink(this.icon.clickThrough, "_blank", { rel: "noreferrer" }) } }, { key: "show", value: function () { clearTimeout(this.showTimeout), this.utils.addClass(this.iconContainer, "jw-ad-icon-active"), this.sendPing(this.icon.trackers.iconView), this.icon.duration && (this.duration = this.utils.seconds(this.icon.duration), this.beginningPosition = this.utils.seconds(this.icon.offset)) } }, { key: "updateTime", value: function (a) { a - this.beginningPosition >= this.duration && this.remove() } }, { key: "sendPing", value: function (a) { if (a) { var e = this.images, t = new Image; t.src = a; for (var d = e.length; d-- && (e[d].width || e[d].complete);)e.length = d; e.push(t) } } }, { key: "remove", value: function () { clearTimeout(this.showTimeout), this.div.contains(this.iconContainer) && this.div.removeChild(this.iconContainer), this.ui && (this.ui.destroy(), this.ui = null) } }]), d }(), _e = function () { function a(e, t, r, i, n, o, s) { m(this, a), this.player = t, this.staticPlayer = r, this.companion = i, this.playlistItemManager = n, this.div = o, this.optionalParams = s, this.debugTrackFn = s.debugTrackFn, this.scheduledAd = e.scheduledAd(), this.vastBuffet = e.adBuffet(), this.vastAdPod = e.adPod(), this.vastAd = this.vastBuffet.length ? this.vastBuffet[0] : null, this.adType = null, this.vpaidPlayer = null, this.instreamPlayer = null, this.blockingInstreamPlayer = null, this.mediaType = null, this.adPodItems = null, this.creativeTimeout = null, this.vastOptions = null, this.duration = 0, this.position = 0, this.initialIndex = 0, this.viewablePlayedTime = 0, this.adViewableImpressionHandler = t.utils.noop, this.lastPosition = null, this.reason = null, y(this, t.Events) } return t(a, [{ key: "init", value: function (a, e) { return this.init = function () { throw new Error("Adplayer can only be initialized once") }, this.blockingInstreamPlayer = a, this.reason = e, this.prepareAdPod() ? (this.player.on("fullscreen", this.playerFullscreenHandler, this), this.player.on("volume", this.playerVolumeHandler, this), this.player.on("mute", this.muteHandler, this), this.player.on("resize", this.playerResizeHandler, this), this.playAd()) : Promise.reject() } }, { key: "prepareAdPod", value: function () { var p, c = this, t = null, u = 0, m = []; if (this.vastAd && (P(this.vastAd, this.debugTrackFn, this.player, this.optionalParams.trackingFilter), (t = this.prepareAdPodItem(this.vastAd)) && "vpaid" === t.adType && !A(this.vastAd) && (t = null)), this.vastAdPod) for (var n, g = null, y = 0; y < this.vastAdPod.length; y++) { n = this.vastAdPod[y], P(n, this.debugTrackFn, this.player, this.optionalParams.trackingFilter); var v = this.prepareAdPodItem(n); if (v) { if (g !== v.adType && "instream" === g) break; if (g = v.adType, "vpaid" !== v.adType || A(n)) { var l = m.length + u === y; v && l && m.push(v) } else u++ } else u++ } return m.length || t ? (m.length ? (p = m, this.vastOptions = [], p.forEach(function (a) { c.vastOptions.push(c.getInstreamOptions(a.vastAd)) })) : (p = t, this.vastOptions = this.getInstreamOptions(this.vastAd)), this.adPodItems = p, !0) : (this.scheduledAd._pod && this.scheduledAd._pod.length || this.adError("No Compatible Creatives", 403), !1) } }, { key: "prepareAdPodItem", value: function (d) { d.tracker.linear = "linear"; var e = "".concat(d.media[0].adType).toLowerCase() || "instream"; "vpaid" !== e || A(d) || (e = "instream"); var l = { vastAd: d, sources: [], adType: e }; void 0 !== this.scheduledAd.skipoffset && (l.skipoffset = this.scheduledAd.skipoffset); var i = d.media, r = {}; if (i.forEach(function (a) { l.sources.push({ file: a.file, mimeType: a.type, type: ("" + a.type).replace(/^(?:video|audio)\/(?:x-)?/, "") }), r[a.file] = { width: a.width || 0, height: a.height || 0 } }), "instream" === e && (l.sources = function (a) { var d = jwplayer.api.availableProviders.filter(function (a) { return "flash" !== a.name }); var e = a.filter(function (a) { return d.some(function (e) { return e.supports(a) }) }), t = e.filter(function (a) { return "3gpp" !== a.type }); return t.length ? t : e }(l.sources)), 0 === l.sources.length) return null; l.vastAd.selectedMedia = l.sources[0]; var n = this.player.getSafeRegion(!0), a = null, p = null; return l.sources.forEach(function (d) { var e = r[d.file]; e.width <= n.width && (!a || e.width > r[a.file].width) && (a = d), e.width >= n.width && (!p || e.width < r[p.file].width) && (p = d) }), a ? (l.vastAd.selectedMedia = a, a.default = !0) : p && (l.vastAd.selectedMedia = p, p.default = !0), this.mediaType = l.vastAd.selectedMedia.mimeType.toLowerCase(), l.sources = [l.vastAd.selectedMedia], l } }, { key: "getInstreamOptions", value: function (a) { return { skipoffset: this.getSkipOffset(a), skipMessage: this.optionalParams.skipMessage, skipText: this.optionalParams.skipText } } }, { key: "getSkipOffset", value: function (a) { var e = [this.scheduledAd.skipoffset, this.optionalParams.skipoffset, a.skipoffset].filter(function (a) { return null != a }); return a.skipoffset = e.length ? this.player.utils.seconds(e[0]) : void 0, a.skipoffset } }, { key: "getVastAd", value: function () { var a, r = this.scheduledAd._adPodIndex; if (this.adPodItems) { if ((a = this.adPodItems.length ? this.adPodItems[r] : this.adPodItems).vastAd) return a.vastAd; } else if (this.vastAdPod && this.vastAdPod.length) return this.vastAdPod[r]; return this.vastAd } }, { key: "adError", value: function (a, e, d) { clearTimeout(this.creativeTimeout), this.creativeTimeout = null; var p = this.getVastAd(); b(p), e = e || 900; var r = "vpaid" === this.adType ? 5e4 : 1e4; d = d || r + e; var n = y({}, this.scheduledAd, p), s = { jwpseg: n.jwpseg }, o = u(this.playlistItemManager, { message: a, code: e, adErrorCode: d }, n, s); this.vastAdPod && this.scheduledAd._adPodIndex < this.vastAdPod.length - 1 ? this.triggerEvent("adPodError", o) : (p.tracker.error(o.code), this.triggerEvent("adError", o), this.removePlayerListeners()) } }, { key: "playAd", value: function () { var a = this.scheduledAd._adPodIndex, e = this.adPodItems[a] || this.adPodItems; if (this.adType = e.adType, this.blockingInstreamPlayer) { var t = this.optionalParams.loadingAd; this.blockingInstreamPlayer.setText(t) } if ("vpaid" === this.adType) return this.playVpaid(e.vastAd); if ("static" === this.adType) return this.playStatic(), Promise.resolve(); var d = Array.isArray(this.adPodItems) ? this.adPodItems.slice(a) : this.adPodItems, r = Array.isArray(this.vastOptions) ? this.vastOptions.slice(a) : this.vastOptions; return this.initialIndex = a, this.playInstream(d, r) } }, { key: "clearVpaidBlocking", value: function () { var a = this.vpaidPlayer.instream; a && a !== this.blockingInstreamPlayer && (this.vpaidPlayer.instream = null, this.clearBlocking(a)) } }, { key: "clearBlocking", value: function (a) { (a = a || this.blockingInstreamPlayer) && a !== this.instreamPlayer && a.destroy() } }, { key: "getState", value: function () { return this.instreamPlayer ? this.instreamPlayer.getState() : this.vpaidPlayer ? this.vpaidPlayer.getState() : "" } }, { key: "clearNonlinear", value: function () { this.staticPlayer.stop(), this.vpaidPlayer && (this.clearVpaidBlocking(), this.vpaidPlayer && (this.vpaidPlayer.stop(), this.vpaidPlayer.destroy(), this.vpaidPlayer = null)) } }, { key: "destroy", value: function () { if (this.off(), this.removePlayerListeners(), clearTimeout(this.creativeTimeout), this.creativeTimeout = null, this.instreamPlayer) { var a = this.instreamPlayer; this.instreamPlayer = null, this.clearBlocking(a) } this.vpaidPlayer && (this.clearVpaidBlocking(), this.vpaidPlayer && (this.vpaidPlayer.destroy(), this.vpaidPlayer = null)), this.clearNonlinear(), b(this.vastAd), this.player = null, this.instreamPlayer = null, this.scheduledAd = null, this.vastBuffet = null, this.vastAd = null, this.vastAdPod = null } }, { key: "pause", value: function (a) { var e = a.reason; this.reason = e || "external", this.instreamPlayer ? this.instreamPlayer.pause() : this.vpaidPlayer && this.vpaidPlayer.pause() } }, { key: "play", value: function (a) { var e = a.reason; this.reason = e || "external", this.instreamPlayer ? this.instreamPlayer.play() : this.vpaidPlayer && this.vpaidPlayer.play() } }, { key: "skip", value: function () { if (this.instreamPlayer) { var a = this.getSkipOffset(this.getVastAd()); if (0 < a && this.position < a) return; this.instreamPlayer.skipAd() } else this.vpaidPlayer && this.vpaidPlayer.skip() } }, { key: "removePlayerListeners", value: function () { this.player && (this.player.off("fullscreen", this.playerFullscreenHandler, this), this.player.off("volume", this.playerVolumeHandler, this), this.player.off("mute", this.muteHandler, this), this.player.off("viewable", this.viewableHandler, this)), this.instreamPlayer && this.instreamPlayer.off(null, null, this), this.vpaidPlayer && (this.vpaidPlayer.removeEvents(), this.clearVpaidBlocking(), this.vpaidPlayer && (this.vpaidPlayer.destroy(), this.vpaidPlayer = null)), this.staticPlayer.stop(), this.staticPlayer.removeEvents() } }, { key: "adEventObject", value: function (a) { var e = this.getVastAd(), t = y({}, this.scheduledAd, e), d = k(this.playlistItemManager, t); return d.viewable = this.player.getViewable(), this.adPodItems && this.adPodItems.length && (d.sequence = this.scheduledAd._adPodIndex + 1, d.podcount = this.adPodItems.length), this.mediaType && (d.creativetype = this.mediaType), this.scheduledAd._vmap && (d.vmap = this.scheduledAd._vmap), -1 !== F.indexOf(a) && (d.universalAdId = e.universalAdId, d.categories = e.categories), d } }, { key: "playStatic", value: function () { this.vastAd.tracker.linear = "nonlinear"; var a = this.vastAd.media[0]; this.vastAd.selectedMedia = a; var e = this.vastAd.clickthrough || "", t = this.staticPlayer; t.removeEvents(), t.on("play", this.impressionHandler, this), t.on("play", this.playHandler, this), t.on("complete", this.combinedCompleteHandler, this), t.on("click", this.clickStaticHandler, this), t.on("error", this.staticErrorHandler, this), this.playlistItemManager.addStaticOffset(this.scheduledAd._offSet), t.playAd(a.file, e, a.minDuration, this.scheduledAd._currentTag, this.scheduledAd.requestTimeout), this.clearBlocking() } }, { key: "creativeAdError", value: function (a, e, t) { this.adError(a, e, t), this.adPodItems && this.adPodItems.length - 1 > this.scheduledAd._adPodIndex && (this.vpaidPlayer && (this.vpaidPlayer.destroy(), this.vpaidPlayer = null), this.scheduledAd._adPodIndex++ , this.playAd()) } }, { key: "playVpaid", value: function (a) { var e = this; clearTimeout(this.creativeTimeout), this.creativeTimeout = setTimeout(function () { e.creativeAdError("VPAID tag communication timeout", 900, 50004) }, this.scheduledAd.creativeTimeout), this.vastAd = a; var t = A(a), d = this.optionalParams.conditionaladoptout && a.conditionalAd; if (this.vastAd.selectedMedia = t, this.mediaType = t.type, "flash" === s(t)) return this.creativeAdError("Flash creatives are not supported", 403, 10403), Promise.reject(); var r = { adParams: this.vastAd.adParams, vpaidControls: this.optionalParams.vpaidcontrols, adOptOut: d }; return this.vpaidPlayer = new W(this.player, this.blockingInstreamPlayer, t.file, this.scheduledAd._currentTag, r), this.blockingInstreamPlayer && this.blockingInstreamPlayer.applyProviderListeners(this.vpaidPlayer), this.vpaidPlayer.on("play", this.playHandler, this), this.vpaidPlayer.on("pause", this.pauseHandler, this), this.vpaidPlayer.on("quartile", this.quartileHandler, this), this.vpaidPlayer.on("remainingTimeChange", this.remainingTimeHandler, this), this.vpaidPlayer.on("click", this.clickVpaidHandler, this), this.vpaidPlayer.on("error", this.playbackErrorHandler, this), this.vpaidPlayer.on("impression", this.impressionHandler, this), this.vpaidPlayer.on("expandedChange", this.vpaidExpandedHandler, this), this.vpaidPlayer.on("close", this.adCloseHandler, this), this.vpaidPlayer.on("skipped", this.vpaidAdSkipped, this), this.vpaidPlayer.on("stopped", this.endOfVpaidAdHandler, this), this.vpaidPlayer.on("complete", this.adCompleteHandler, this), this.vpaidPlayer.on("started", this.adStartedHandler, this), this.vpaidPlayer.on("skippableStateChange", this.skippableStateChangeHandler, this), Promise.resolve() } }, { key: "skippableStateChangeHandler", value: function (a) { a.skippable && this.blockingInstreamPlayer && (this.blockingInstreamPlayer.off("adSkipped", this.skipVpaidAd, this), this.blockingInstreamPlayer.setupSkipButton(0, this.optionalParams, this.player.utils.noop), this.blockingInstreamPlayer.on("adSkipped", this.skipVpaidAd, this)) } }, { key: "playInstream", value: function (a, e) { var t = this, d = this.player.getEnvironment().OS; if (d.android && 2 === d.version.major && 3 === d.version.minor) return this.adError("Android 2.3 not supported", 900, 60007), Promise.reject(); clearTimeout(this.creativeTimeout), this.creativeTimeout = setTimeout(function () { t.creativeAdError("Video creative timeout", 402, 10402) }, this.scheduledAd.creativeTimeout), this.instreamPlayer = this.blockingInstreamPlayer ? this.blockingInstreamPlayer : this.player.createInstream().init(), this.instreamPlayer.on("play", this.playHandler, this), this.instreamPlayer.on("pause", this.pauseHandler, this), this.instreamPlayer.on("time", this.timeHandler, this), this.instreamPlayer.on("playlistItem", this.playlistItemHandler, this), this.instreamPlayer.on("complete", this.adCompleteHandler, this), this.instreamPlayer.on("playlistComplete", this.endOfAdBreakHandler, this), this.instreamPlayer.on("mute", this.muteHandler, this), this.instreamPlayer.on("instreamClick", this.clickInstreamHandler, this), this.instreamPlayer.on("adSkipped", this.adSkipped, this), this.instreamPlayer.on("error", this.playbackErrorHandler, this), this.instreamPlayer.on("mediaError", this.playbackErrorHandler, this), this.instreamPlayer.on("destroyed", function () { t.instreamPlayer = null }, this); var r = this.instreamPlayer.loadItem(a, e); return this.clearBlocking(), r } }, { key: "playerFullscreenHandler", value: function (a) { var e = this.getVastAd().tracker; a.fullscreen && e.started && e.fullscreen() } }, { key: "playerResizeHandler", value: function (a) { this.vpaidPlayer && this.vpaidPlayer.resize(a.width, a.height) } }, { key: "playerVolumeHandler", value: function (a) { this.vpaidPlayer && this.vpaidPlayer.setVolume(a.volume) } }, { key: "playlistItemHandler", value: function (a) { this.instreamPlayer && (this.scheduledAd._adPodIndex = a.index + this.initialIndex, 0 < this.scheduledAd._adPodIndex && this.triggerEvent("adItem")) } }, { key: "impressionHandler", value: function (a) { var e = this.getVastAd(), t = e.tracker; t.impression(); var d = y({}, this.scheduledAd, e); this.triggerEvent("adImpression", k(this.playlistItemManager, d, { duration: a.duration || e.duration || this.getDurationFromVideoTag(), linear: a.linear || t.linear })), this.setupViewableListener() } }, { key: "getDurationFromVideoTag", value: function () { var a = this.blockingInstreamPlayer ? this.blockingInstreamPlayer.getMediaElement() : null; return a ? a.duration : 0 } }, { key: "setupViewableListener", value: function () { this.player.off("viewable", this.viewableHandler, this), this.player.on("viewable", this.viewableHandler, this), this.viewableHandler({ viewable: this.player.getViewable() }) } }, { key: "viewableHandler", value: function (a) { a.viewable ? (this.viewablePlayedTime = 0, this.lastPosition = null, this.adViewableImpressionHandler = this.adViewableHandler) : this.adViewableImpressionHandler = this.player.utils.noop } }, { key: "playHandler", value: function (a) { var p = this; clearTimeout(this.creativeTimeout), this.creativeTimeout = null; var e, t = this.getVastAd(), r = t.tracker; if (r.started) "paused" === a.oldstate && (r.resume(), this.dispatchPlay(a)); else { this.vpaidPlayer && (r.linear = a.linear), this.instreamPlayer && this.impressionHandler({ linear: r.linear }); var n = y({}, this.scheduledAd, t), s = k(this.playlistItemManager, n, { linear: r.linear, metadata: !0 }); if (this.triggerEvent("adMeta", s), t.companions) { var o = k(this.playlistItemManager, n, { companions: (e = t.companions, e.map(function (a) { var e, r = "iframe" === a.type || "html" === a.type ? a.type : "static"; return a.trackers && a.trackers.creativeView && a.trackers.creativeView.length && (e = a.trackers.creativeView), { width: a.width, height: a.height, type: r, resource: a.source, creativeview: e, click: a.clickthrough } })) }); this.triggerEvent("adCompanions", o) } t.icons && (t.iconInstances = t.icons.map(function (a) { return new ue(p.player, a, p.div) })); var l, c = this.companion; l = 9 < this.player.utils.flashVersion() ? t.companions : function (a) { return a ? a.filter(function (a) { return 0 > a.type.indexOf("flash") }) : [] }(t.companions), this.optionalParams.companion && l && l.length && (r.hasComp = c.addCompanion(this.optionalParams.companion, l)), r.start(), r.creativeView(), this.dispatchPlay(a) } } }, { key: "dispatchPlay", value: function (a) { "static" === this.adType || "vpaid" === this.adType && "linear" !== a.linear || (null === this.reason && "vpaid" === this.adType && (this.reason = "external"), this.setState(a)) } }, { key: "pauseHandler", value: function (a) { clearTimeout(this.creativeTimeout), this.creativeTimeout = null, this.getVastAd().tracker.pause(), null === this.reason && "vpaid" === this.adType && (this.reason = "external"), this.setState(a) } }, { key: "setState", value: function (a) { var e = a.newstate, t = a.oldstate, d = e === "playing", r = this.adEventObject(d ? "adPlay" : "adPause"); (r.newstate = e, null !== this.reason) && (r[d ? "playReason" : "pauseReason"] = this.reason, this.reason = null), this.vpaidPlayer ? (r.oldstate = t, this.vpaidPlayer.trigger("state", r)) : this.instreamPlayer.setEventData(r) } }, { key: "remainingTimeHandler", value: function (a) { var e = this; this.duration = a.duration ? a.duration : Math.max(1, this.duration, a.remainingTime); var t = 0 <= a.remainingTime ? this.duration - a.remainingTime : 0; this.position === t ? this.creativeTimeout = this.creativeTimeout || setTimeout(function () { e.creativeAdError("Video stall", 400) }, this.scheduledAd.creativeTimeout) : this.creativeTimeout && (clearTimeout(this.creativeTimeout), this.creativeTimeout = null), this.timeHandler({ position: t, duration: this.duration, isDurationChange: a.isDurationChange }) } }, { key: "quartileHandler", value: function (a) { if (a.duration) this.duration = a.duration; else { var e = 4 * a.remainingTime / (4 - a.quartile); this.duration = Math.max(this.duration, 1, e) } this.timeHandler({ position: .25 * (this.duration * a.quartile), duration: this.duration }) } }, { key: "adViewableHandler", value: function (a) { var e = a.position; null === this.lastPosition && (this.lastPosition = e); var t = e - this.lastPosition; this.lastPosition = e, t = Math.min(Math.max(0, t), 4), this.viewablePlayedTime += t, 2 <= this.viewablePlayedTime && (this.player.off("viewable", this.viewableHandler, this), this.adViewableImpressionHandler = this.player.utils.noop, this.triggerEvent("adViewableImpression", {})) } }, { key: "timeHandler", value: function (p) { var e = this.getVastAd(), t = p.position, i = p.duration; this.adViewableImpressionHandler(p); var r = i - t, n = e.tracker, a = this.optionalParams.dynamicMessage || "", c = this.optionalParams.podMessage || ""; if (a && 0 < r) { if (a = a.replace(/(\b)xx(s?\b)/gi, "$1".concat(Math.ceil(r), "$2")), this.adPodItems && 1 < this.adPodItems.length && c) { var u = this.scheduledAd._adPodIndex + 1; a = (c = (c = c.replace(/__AD_POD_CURRENT__/g, "".concat(u))).replace(/__AD_POD_LENGTH__/g, "".concat(this.adPodItems.length))) + " " + a } this.instreamPlayer ? this.instreamPlayer.setText(a) : this.vpaidPlayer && this.vpaidPlayer.instream && this.vpaidPlayer.instream.setText(a) } if (!p.isDurationChange) { n && n.time(t, i), e.iconInstances && e.iconInstances.forEach(function (a) { a.updateTime(t) }); var l = {}; l.position = this.position = t, l.duration = i, this.triggerEvent("adTime", l) } } }, { key: "combinedCompleteHandler", value: function () { this.adCompleteHandler(), this.endOfAdBreakHandler() } }, { key: "adCompleteHandler", value: function () { clearTimeout(this.viewableTimeout); var a = this.getVastAd(); b(a); var e = a.tracker; e.firedError || (e.complete(), this.triggerEvent("adComplete")) } }, { key: "adCloseHandler", value: function () { clearTimeout(this.viewableTimeout); var a = this.getVastAd().tracker; a.firedError || a.close() } }, { key: "adStartedHandler", value: function () { this.triggerEvent("adStarted") } }, { key: "endOfVpaidAdHandler", value: function () { return (clearTimeout(this.viewableTimeout), this.adPodItems && this.adPodItems.length - 1 > this.scheduledAd._adPodIndex) ? (this.vpaidPlayer && (this.vpaidPlayer.destroy(), this.vpaidPlayer = null), this.scheduledAd._adPodIndex++ , void this.playAd()) : void this.endOfAdBreakHandler() } }, { key: "endOfAdBreakHandler", value: function () { this.removePlayerListeners(), this.trigger("adPlayComplete") } }, { key: "muteHandler", value: function (a) { var e = this.getVastAd().tracker; e && (a.mute ? e.mute() : e.unmute(), this.vpaidPlayer && this.vpaidPlayer.setVolume(a.mute ? 0 : this.player.getVolume())) } }, { key: "clickStaticHandler", value: function () { var a = this.getVastAd(); this.player.pause({ reason: "clickthrough" }), this.clickThrough(a) } }, { key: "clickVpaidHandler", value: function (a) { var e = this.getVastAd(), t = !0; a && void 0 !== a.url && (!1 === a.playerHandles && (t = !1), e.clickthrough = a.url), this.clickThrough(e, t) } }, { key: "clickInstreamHandler", value: function () { "paused" !== this.instreamPlayer.getState() && this.clickThrough(this.getVastAd()) } }, { key: "clickThrough", value: function (a) { var e = !(1 < arguments.length && void 0 !== arguments[1]) || arguments[1]; a.tracker.click(); var t = {}; a.clickthrough && (t.clickThroughUrl = a.clickthrough), this.reason = "clickthrough", this.triggerEvent("adClick", t), window.jwcast && window.jwcast.player.id || a.clickthrough && e && window.open(a.clickthrough) } }, { key: "skipVpaidAd", value: function () { this.vpaidPlayer && this.vpaidPlayer.skip() && this.vpaidAdSkipped() } }, { key: "vpaidAdSkipped", value: function () { this.adSkipped(), this.endOfVpaidAdHandler() } }, { key: "adSkipped", value: function () { clearTimeout(this.viewableTimeout); var a = this.getVastAd(); a.tracker.skip(), b(a); var e = "vpaid" === this.adType ? void 0 : this.getSkipOffset(a); this.triggerEvent("adSkipped", { duration: a.duration, skipoffset: e, position: this.position, watchedPastSkipPoint: this.position - e }) } }, { key: "playbackErrorHandler", value: function (a) { var e = a.message || "Error Playing Ad Tag", t = a.code; t && 232404 === t ? t = 403 : (!t || 4 >= t || 901 < t) && (t = 405), this.vpaidPlayer && "function" == typeof this.vpaidPlayer.off ? (this.vpaidPlayer.off(), this.creativeAdError(e, t, a.adErrorCode)) : this.adError(e, t, a.adErrorCode) } }, { key: "staticErrorHandler", value: function () { this.adError("Unable to fetch NonLinear resource", 502) } }, { key: "vpaidExpandedHandler", value: function (a) { var e = this.getVastAd().tracker; a.expanded ? e.expand() : e.collapse() } }, { key: "triggerEvent", value: function (a, e) { var t = this.adEventObject(a); e && y(t, e), this.trigger(a, t), -1 === he.indexOf(a) && this.player.trigger(a, t) } }]), a }(), ve = function () { function a(e, t, r) { m(this, a), this.debugTrackFn = e, this.div = null, this.elem = null, this.environment = t, this.utils = r } return t(a, [{ key: "addCompanion", value: function (a, e) { if (this.div = a, this.elem = document.getElementById(this.div.id), !this.elem) return !1; for (var t = 0; t < e.length; t++)if (this.fitsDiv(e[t])) return this.placeCompanion(e[t]), !0; return !1 } }, { key: "removeCompanion", value: function () { this.elem.innerHTML = "" } }, { key: "sendPings", value: function (a) { (a = a.creativeView) && (a.forEach(function (a) { new Image().src = a }), "function" == typeof this.debugTrackFn && this.debugTrackFn({ type: "companion", data: { trackers: a } })) } }, { key: "placeCompanion", value: function (d) { var o = this; if (this.removeCompanion(), "html" === d.type) { var e = document.createElement("div"); e.innerHTML = d.source; var t = e.getElementsByTagName("script"); return t.length && t.forEach(function (a) { new o.utils.scriptloader(a.src).load(), a.parentElement.removeChild(a) }), this.elem.appendChild(e), void this.sendPings(d.trackers) } if ("iframe" === d.type) { var r = document.createElement("iframe"); return r.height = this.div.height, r.width = this.div.width, r.src = d.source, r.scrolling = "no", r.style.border = "none", r.marginWidth = 0, r.marginHeight = 0, this.sendPings(d.trackers), this.elem.innerHTML = "", void this.elem.appendChild(r) } if ("application/x-shockwave-flash" === d.type) { var n = document.createElement("object"); return n.setAttribute("type", "application/x-shockwave-flash"), n.setAttribute("data", d.source), n.setAttribute("width", "100%"), n.setAttribute("height", "100%"), n.setAttribute("tabindex", 0), i(n, "allowfullscreen", "true"), i(n, "allowscriptaccess", "always"), i(n, "seamlesstabbing", "true"), i(n, "wmode", "opaque"), this.elem.appendChild(n), void this.sendPings(d.trackers) } var a = new Image; a.src = d.source, d.clickthrough && (a.onclick = function () { o.utils.openLink(d.clickthrough, "_blank", { rel: "noreferrer" }) }), this.elem.innerHTML = "", this.elem.appendChild(a), this.sendPings(d.trackers) } }, { key: "fitsDiv", value: function (a) { return a.width === this.div.width && a.height === this.div.height } }]), a }(), fe = /^((https?:)?\/\/)?(secure)?pubads\.g\.doubleclick\.net\/gampad\/ads\?[\S]*$/, Ae = Array.prototype, Pe = Ae.forEach, we = Ae.map, Te = function () { }, Ie = function () { function a(t, e) { m(this, a), this.utils = e, this._error = null, this._version = null, t && this.parse(t) } return t(a, [{ key: "error", value: function () { return this._error } }, { key: "version", value: function () { return this._version } }, { key: "parse", value: function (d, e) { var t, l = this; "VAST" === d.nodeName ? t = d : (t = C(d, "VAST")) || (t = C(d, "VideoAdServingTemplate")), t || this.throwError(101, "Invalid VAST response"); var r = "VideoAdServingTemplate" === t.tagName ? 1 : parseFloat(S(t, "version") || 0); this._version = r; var n, p = E(t, "Ad"), s = we.call(p, function (t) { var i = l.parseAd(r, t); return i.vastversion = r, i.response = d, i.request = e || null, i }); return s.length || (n = E(t, "Error"), Pe.call(n, function (a) { var e = x(a).replace("[ERRORCODE]", 303); new Image().src = e })), s } }, { key: "parseAd", value: function (e, a, t) { t = t || {}; var i, p, m, g = C(a, "InLine"), l = C(a, "Wrapper"), v = g || l, u = v ? x(C(v, "AdTitle")) : ""; return t.sequence = S(a, "sequence"), t.adId = S(a, "id"), t.adTitle = u, t.description = x(C(v, "Description")), (!e || 4.2 < e || 2 > e) && this.throwError(102, "Vast version not supported"), 4 <= e && (t.conditionalAd = !!S(a, "conditionalAd")), v ? (L(v, "Impression", (i = function (d, m, e) { var t = E(C(d, "Creatives"), "Creative"), r = {}, i = { trackers: r }; i.adServingId = x(C(d, "AdServingId")), i.adsystem = x(C(d, "AdSystem")); var a = E(d, "Category"); return i.categories = we.call(a, function (a) { return x(a) }), Pe.call(t, function (a) { var t = C(a, "Linear"), n = C(a, "NonLinear"), s = E(C(a, "TrackingEvents"), "Tracking"); if (4 <= m) { var o = E(a, "UniversalAdId"); i.universalAdId = we.call(o, function (a) { return { universalAdIdRegistry: S(a, "idRegistry") || "unknown", universalAdIdValue: x(a) || S(a, "idValue") || "unknown" } }) } i.creativeId = S(a, "id"), i.creativeAdId = S(a, "adId"), (t || n) && Pe.call(s, function (a) { R(r, a) }); var l = x(C(a, "AdParameters")); if (l && (i.adParams = l), t) { var d = C(t, "VideoClicks"), u = x(C(d, "ClickThrough")), c = E(d, "ClickTracking"), g = S(t, "skipoffset"), p = x(C(t, "Duration")); Pe.call(c, function (a) { j(r, "click", x(a)) }), p && (i.duration = e.seconds(p)), u && (i.clickthrough = u), void 0 !== g && (i.skipoffset = g), function (a, e) { var t = E(C(a, "MediaFiles"), "MediaFile"), d = e.media ? e.media : []; e.media = d.concat(we.call(t, function (a) { return { type: S(a, "type"), file: x(a), adType: S(a, "apiFramework") || "", width: parseInt(S(a, "width"), 10) || 0, height: parseInt(S(a, "height"), 10) || 0 } }).filter(function (a) { return a.file })) }(t, i), function (a, e) { var t = E(a, "Icon"); e.icons = Array.prototype.reduce.call(t, function (d, e) { var t, p; if (t = C(e, "StaticResource")) p = S(t, "creativeType"); else if (t = C(e, "IFrameResource")) p = "iframe"; else { if (!(t = C(e, "HTMLResource"))) return d; p = "html" } var c = x(t), n = {}; n.iconClick = x(C(e, "IconClickTracking")) || null, n.iconView = x(C(e, "IconViewTracking")) || null; var a = S(e, "xPosition"), s = S(e, "yPosition"), o = {}; return "left" === a || "right" === a ? o[a] = 0 : o.left = parseInt(a, 10) || 0, "top" === s || "bottom" === s ? o[s] = 0 : o.top = parseInt(s, 10) || 0, o.width = parseInt(S(e, "height"), 10) || 0, o.height = parseInt(S(e, "height"), 10) || 0, d.push({ program: S(e, "program"), style: o, apiFramework: S(e, "apiFramework"), offset: S(e, "offset") || "00:00:00", duration: S(e, "duration") || null, clickThrough: x(C(e, "IconClickThrough")), trackers: n, resource: { resourceType: p, resourceSource: c } }), d }, e.icons || []) }(t, i) } else if (n) { var y = x(C(n, "NonLinearClickThrough")); y && (i.clickthrough = y), function (a, e) { var t = [], d = C(a, "StaticResource"); d && (t.push({ type: S(d, "creativeType"), file: x(d), adType: S(C(a, "NonLinear"), "apiFramework") || "static", minDuration: S(C(a, "NonLinear"), "minSuggestedDuration") || "00:00:00" }), e.media = t) }(a, i) } else !function (a, e) { var t = E(C(a, "CompanionAds"), "Companion"), p = e.companions ? e.companions : []; Pe.call(t, function (r) { var e, c, u = C(r, "StaticResource"), n = C(r, "IFrameResource"), a = C(r, "HTMLResource"), s = {}; if (u) e = S(u, "creativeType"), c = x(u); else if (n) e = "iframe", c = x(n); else { if (!a) return; e = "html", c = x(a) } var o = E(C(r, "TrackingEvents"), "Tracking"); Pe.call(o, function (a) { var e = S(a, "event"); j(s, e, x(a)) }); var l = x(C(r, "CompanionClickThrough")); p.push({ width: parseInt(S(r, "width"), 10), height: parseInt(S(r, "height"), 10), type: e, source: c, trackers: s, clickthrough: l }) }), e.companions = p }(a, i) }), i }(v, e, this.utils)).trackers), L(v, "Error", i.trackers), function (a) { var d = {}; a.media && a.media.forEach(function (a) { var e = a.type; "vpaid" === a.adType.toLowerCase() || "application/x-mpegURL" === e || "vnd.apple.mpegURL" === e || (d[e] = d[e] || 0, d[e]++) }), a.mediaFileCompliance = !0, Object.keys(d).forEach(function (e) { var t = d[e]; 3 > t && (a.mediaFileCompliance = !1, a.nonComplianceReasons = a.nonComplianceReasons || [], a.nonComplianceReasons.push("".concat(e, " has only ").concat(t, " qualities"))) }) }(i), l && (i.wrappedURI = x(C(l, "VASTAdTagURI")) || x(C(l, "VASTAdTagURL")), i.followAdditionalWrappers = JSON.parse(S(l, "followAdditionalWrappers")), i.allowMultipleAds = JSON.parse(S(l, "allowMultipleAds")), i.fallbackOnNoAd = JSON.parse(S(l, "fallbackOnNoAd"))), p = i, m = y({}, t), Object.keys(p).forEach(function (e) { var a = p[e]; m[e] = Array.isArray(m[e]) ? m[e].concat(a) : "object" === d(m[e]) && null !== m[e] ? y(m[e], a) : a }), i = m) : this.throwError(303, "No ads", 10303), i } }, { key: "throwError", value: function (a, e, t) { throw this._error = new Error(e), this._error.code = a, this._error.adErrorCode = t || 1e4 + a, this._error } }]), a }(), Ee = function (a) { (0 <= a.indexOf("[REGULATIONS]") || 0 <= a.indexOf("[GDPRCONSENT]")) && (be().catch(Te), Ee = Te) }, Ce = function () { function a(e, t) { m(this, a), this.adRules = e, this.utils = t, this.preRoll = null, this.vmap = null, this.postRoll = null, this.midRolls = [], this.playedMidRolls = [], this.duration = 0, this._vmapPromise = null, this._vmapXHR = null } return t(a, [{ key: "load", value: function (a, e, t) { var d = this; if (this._vmapPromise) return this._vmapPromise; null !== this._vmapXHR && (M(this._vmapXHR), this._vmapXHR = null); var r = _(this.getVMAP(), a, e, t); return this._vmapPromise = r.then(function (r) { return new Promise(function (e, o) { d._vmapXHR = a.utils.ajax({ url: r, withCredentials: !0, retryWithoutCredentials: !0, requireValidXML: !0, timeout: d.requestTimeout }, e, function (a, e, t, d) { return o(d) }) }).then(function (e) { return d._vmapXHR = null, function (d, e, t) { var i = [], r = E(d, "VMAP", "vmap"); if (!r.length) throw new Error("No VMAP tag in response"); S(r[0], "version") || T(i, "VMAP Schema Error: version missing from VMAP tag", "-1"); var v = E(d, "AdBreak", "vmap"); v.length || I(); for (var a = d.lookupNamespaceURI("vmap"), s = 0; s < v.length; s++) { var j = {}, l = {}, u = v[s], c = S(u, "timeOffset"), h = S(u, "breakId"), p = S(u, "breakType"), f = S(E(u, "AdSource", "vmap")[0], "id"), m = E(u, "AdTagURI", "vmap")[0], g = E(u, "VASTData", "vmap")[0] || E(u, "VASTAdData", "vmap")[0], y = S(m, "templateType"), k = x(m), A = n(a, u, "Tracking", "vmap"); if (p || T(i, "VMAP Schema Error: missing breakType on AdBreak", h), g || y || T(i, "VMAP Schema Error: missing templateType on AdBreak", h), c || T(i, "VMAP Schema Error: missing timeOffset on AdBreak", h), j._type = p, j._vmap = { id: f, breakid: h, timeoffset: c }, g) j._adXML = C(g, "VAST"); else { if ("vast2" !== y && "vast3" !== y && "vast4" !== y) continue; j._adQueue = [k], j._waterfallIndex = 0 } var w = []; if (A) for (var P = 0; P < A.length; P++) { R(l, A[P]); var L = S(A[P], "event"); w.push(L) } switch ((0 > w.indexOf("breakStart") || 0 > w.indexOf("breakEnd") || 0 > w.indexOf("error")) && T(i, "Tracking events are missing breakStart, breakEnd, or error for AdBreak", h), j._trackers = l, j._type = p, c) { case "start": j._offSet = "pre", e.setPreRoll(j); break; case "100%": case "end": j._offSet = "post", e.setPostRoll(j); break; default: if (/^#/.test(c)) break; j._offSet = /^\d\d?(?:\.\d+)?%$/.test(c) ? c : t.seconds(c), e.addMidRoll(j); } } return e.preRoll || e.midRolls.length || e.postRoll || I(), e.sort(null, !0), i }(e.responseXML, d, a.utils).map(function (a) { return y(a, { vmap: r }) }) }).catch(function (e) { d._vmapXHR = null; var t = { id: "-1", vmap: r }; if (e.message) y(t, { message: "VMAP Schema Error: ".concat(e.message), code: 1002, adErrorCode: e.adErrorCode || 11002 }); else { var i = { 1: { code: 1007, message: "Timeout" }, 602: { code: 1e3, message: "Invalid XML" }, default: { code: 1008, message: a.getConfig().localization.errors[e.key] } }, n = i[e.code] || i.default; a.utils.log(n.message), y(t, { message: "Error Loading VMAP Schedule", code: n.code, adErrorCode: n.code + 1e4 }) } throw t }) }), this._vmapPromise } }, { key: "canWaterfall", value: function (a) { return a._adQueue && a._waterfallIndex + 1 < a._adQueue.length } }, { key: "getPreRoll", value: function (a) { return a && "none" === this.adRules.startOnSeek ? null : V(this.preRoll, this.requestTimeout, this.creativeTimeout) } }, { key: "getPostRoll", value: function (a) { var e = V(this.postRoll, this.requestTimeout, this.creativeTimeout); return this.adRules.timeBetweenAdsAllowsAdPlayback(e, a) ? e : null } }, { key: "getMidRollAtIndex", value: function (a) { return V(this.midRolls[a], this.requestTimeout, this.creativeTimeout) } }, { key: "getLastMidRollIndexBetweenTime", value: function (d, e, t) { if (d > e) return null; this.sort(t); for (var i = this.midRolls.length; i--;) { var o = this.midRolls[i], n = B(this.midRolls[i]._offSet, t); if (d >= n) return null; if (e >= n) { var a = V(o, this.requestTimeout, this.creativeTimeout); if (!this.adRules.timeBetweenAdsAllowsAdPlayback(a)) return null; if (!this.adRules.timeBetweenAds) { if (0 <= this.playedMidRolls.indexOf(i)) return null; this.playedMidRolls.push(i) } return i } } return null } }, { key: "peek", value: function (d, e, t) { if (this.midRolls.length > this.playedMidRolls.length) { this.sort(t); for (var i, o = 0; this.midRolls[o];) { if (i = B(this.midRolls[o]._offSet, t), i >= d && -1 === this.playedMidRolls.indexOf(o)) { var l = re() + 1e3 * (i - d); return i <= e && this.adRules.timeBetweenAdsAllowsAdPlayback(null, l) ? o : null } o += 1 } } var a = re() + 1e3 * (t - d); return this.postRoll && e >= t && this.adRules.timeBetweenAdsAllowsAdPlayback(null, a) ? -1 : null } }, { key: "getNextMidrollIndex", value: function (a, e, t) { if (this.adRules.timeBetweenAds || this.adRules.startOnSeek) return this.getLastMidRollIndexBetweenTime(a, e, t); if (this.midRolls.length > this.playedMidRolls.length) { var d = this.getClosestIndex(e, t); if (0 <= d && 0 > this.playedMidRolls.indexOf(d)) return this.playedMidRolls.push(d), d } return null } }, { key: "getMidRolls", value: function () { var a = this; return this.midRolls.map(function (e) { return V(e, a.requestTimeout, a.creativeTimeout) }) } }, { key: "reset", value: function () { null !== this._vmapXHR && (M(this._vmapXHR), this._vmapXHR = null), this.playedMidRolls = [], this.duration = 0 } }, { key: "resetBreakIdByOffset", value: function (a) { var e; a && (e = "pre" === a ? this.preRoll : "post" === a ? this.postRoll : this.midRolls[a], this.resetBreakId(e)) } }, { key: "setPreRoll", value: function (a) { this.resetBreakId(a), this.preRoll = a } }, { key: "addMidRoll", value: function (a) { this.resetBreakId(a), this.midRolls.push(a), this.duration = 0 } }, { key: "setPostRoll", value: function (a) { this.resetBreakId(a), this.postRoll = a } }, { key: "sort", value: function (a, r) { (!a || 1 > a) && (a = 1), (this.duration !== a || r) && (this.duration = a, this.midRolls.sort(function (e, t) { return B(e._offSet, a) - B(t._offSet, a) }), function (a, e) { for (var t, d = 0; d < a.length; d++)t = a[d], e ? t._vmap.item = d + 1 : (t._adbreak = { item: d + 1, breakid: t._breakId }, t._pod ? t._adbreak.pod = t._pod : t._adbreak.tags = t._adQueue) }(this.getAllAds(), r)) } }, { key: "getAllAds", value: function () { var a = this.preRoll ? [this.preRoll] : [], e = this.postRoll ? [this.postRoll] : []; return a.concat(this.midRolls, e) } }, { key: "setVMAP", value: function (a) { this.vmap = a } }, { key: "isVMAP", value: function () { return !!this.vmap } }, { key: "getVMAP", value: function () { return this.vmap } }, { key: "getClosestIndex", value: function (a, e) { this.sort(e); for (var t = this.midRolls.length; t--;)if (a >= B(this.midRolls[t]._offSet, e)) return t; return -1 } }, { key: "resetBreakId", value: function (a) { a.adBreakId = this.utils.genId(12) } }]), a }(), Se = function () { function a(e) { m(this, a), this.utils = e } return t(a, [{ key: "getSchedule", value: function (a, e) { var t = new Ce(e, this.utils); if (t.requestTimeout = H(a.requestTimeout, 5000), t.creativeTimeout = H(a.creativeTimeout, 15000), a.tag) t.setPreRoll({ _offSet: "pre", _adQueue: O(a.tag), _waterfallIndex: 0 }); else if ("string" == typeof a.vastxml) t.setPreRoll({ _offSet: "pre", _adXML: a.vastxml }); else { if ("string" == typeof a.schedule) return t.setVMAP(a.schedule), t; if ("string" == typeof a.adschedule) return t.setVMAP(a.adschedule), t; !function (a, e, m) { var i = e.schedule || e.adschedule; if (i) { var g = {}; Object.keys(i).forEach(function (a) { var e = i[a]; e.ad && (y(e, e.ad), delete e.ad); var t = function (a, e) { if ("start" === a || "0%" === a || !a && 0 !== a) return "pre"; if ("end" === a || "100%" === a) return "post"; if ("pre" === a || "post" === a || 0 <= (a + "").indexOf("%")) return a; var t = e.seconds(a); return "number" == typeof t && t }(e.offset, m), r = H(e.requestTimeout, 5000), n = H(e.creativeTimeout, 15000), o = g[t]; if (o) { if ("nonlinear" === e.type) return; "nonlinear" === o._type && (o = null) } var s = g[t] = o || { _offSet: t, _type: e.type, _breakId: a, requestTimeout: r, creativeTimeout: n }; !1 === t && m.log("Error: ad offset format not supported", t); var l = e.skipoffset; if (void 0 !== l && void 0 === s.skipoffset && (s.skipoffset = l), e.pod) { var c = s._pod || []; s._pod = c.concat(e.pod) } else if (e.tag) { var u = function (d, n) { if (!n) return d; var e = 0 <= d.indexOf("?") ? "&" : "?", t = d.indexOf("cust_params="), r = "", p = ""; if (Object.keys(n).forEach(function (a) { var e = n[a]; r = "".concat(r).concat(p).concat(a, "=").concat(e), p = "&" }), r = encodeURIComponent(r), 0 <= t) { var i = d.substr(0, t + 12), o = d.substr(t + 12); return "".concat(i).concat(r, "%26").concat(o) } return "".concat(d).concat(e, "cust_params=").concat(r) }(e.tag, e.custParams); s._adQueue && (s._pod = [s._adQueue[0]], delete s._adQueue), s._pod ? s._pod.push(O(u)[0]) : s._adQueue = O(u) } else { if ("string" != typeof e.vastxml) return void m.log("Error: no ad tag provided"); s._adXML = e.vastxml } }), Object.keys(g).forEach(function (t) { var d = g[t]; switch (d.skipoffset = void 0 === d.skipoffset ? e.skipoffset : d.skipoffset, t) { case "pre": a.setPreRoll(d); break; case "post": a.setPostRoll(d); break; default: a.addMidRoll(d); } }) } }(t, a, this.utils) } return t.sort(), t } }, { key: "getOptParams", value: function (a, e) { var t = { cuetext: e.cuetext, dynamicMessage: e.admessage, loadingAd: e.loadingAd, podMessage: e.podmessage, skipoffset: a.skipoffset, skipMessage: e.skipmessage, skipText: e.skiptext, vpaidcontrols: a.vpaidcontrols || !1, conditionaladoptout: a.conditionaladoptout || !1, requestFilter: a.requestFilter, trackingFilter: a.trackingFilter }, d = a.companiondiv; return d && (t.companion = { id: d.id, height: d.height, width: d.width }), t } }, { key: "getAdRules", value: function (a) { var e = a.rules || {}, t = parseInt(e.frequency, 10); return { startOn: e.startOn || 1, frequency: isNaN(t) ? 1 : t, timeBetweenAds: e.timeBetweenAds || 0, startOnSeek: e.startOnSeek || null } } }]), a }(), Re = function () { function l(a, e, t, r, d) { m(this, l), this._scheduledAd = a, this.player = e, this.options = t || {}, this.wrapperOptions = r || { followAdditionalAds: !0, allowMultipleAds: !0 }, this.debugTrackFn = d, y(this, e.Events), this._history = [], this.loadedAds = [], this.parser = null, this.promise = null, this.xmlhttp = null, this.wrappedTags = null, this.options.isPodItemLoader || (a.adPlayIds = {}) } return t(l, [{ key: "load", value: function (a) { var e = this; if (null === this.promise) { this._history.push(a); var t = this.options.requestFilter; this.promise = new Promise(function (d, o) { e.xmlhttp = e.player.utils.ajax({ url: a, withCredentials: !0, retryWithoutCredentials: !0, requireValidXML: !0, timeout: e._scheduledAd.requestTimeout, requestFilter: t }, d, function (a, e, t, d) { return o(d) }) }).catch(function (t) { if (null !== e.player) throw e.ajaxError(t, a) }).then(function (t) { if (null !== e.player) return e.parseXMLString(t.responseXML || t.responseText, a) }) } return this.promise } }, { key: "destroy", value: function () { var a; (a = this.xmlhttp) && (a.onload = null, a.onreadystatechange = null, a.onerror = null, a.abort && a.abort()), this.player = null, this.xmlhttp = null } }, { key: "scheduledAd", value: function () { return this._scheduledAd } }, { key: "allAds", value: function () { return this.loadedAds } }, { key: "podMultipleVastLoaders", value: function (a) { var d = this, e = a.map(function (a) { return a.then(function (a) { var e = a.adPod(); if (e.length) return e; var t = a.adBuffet(); return t.length ? [t[0]] : Promise.reject({ vloader: d, message: "No compatible ad" }) }).catch(function (a) { return { error: a } }) }); return Promise.all(e).then(function (a) { var o = 0, e = a.reduce(function (i, e, t) { if (e.error) return e.error.tagIndex = t, d.trigger("adPodError", e.error), i; if (e.length && 0 !== t) { var r = "p".concat(o, "w").concat(d._scheduledAd._waterfallIndex); d._scheduledAd.adPlayIds[r] = d._scheduledAd.adRequestIds[t] } return e.forEach(function (e) { e.sequence = ++o, i.push(e) }), i }, []); return e.length ? (d.loadedAds = e, d) : null }) } }, { key: "adPod", value: function () { var a = []; return this.loadedAds.forEach(function (e) { e.sequence && a.push(e) }), a.sort(function (a, e) { return a.sequence - e.sequence }), a } }, { key: "adBuffet", value: function () { var a = []; return this.loadedAds.forEach(function (e) { e.sequence || a.push(e) }), a } }, { key: "parseXMLString", value: function (e, o) { var p = this; return null === this.parser && (this.parser = new Ie(null, this.player.utils)), new Promise(function (t) { var i, n = (i = e, ("object" === ("undefined" == typeof Node ? "undefined" : d(Node)) ? i instanceof Node : i && "object" === d(i) && "number" == typeof i.nodeType && "string" == typeof i.nodeName) ? e : p.player.utils.parseXML(e)); if (null === n) throw { message: "Invalid XML", code: 100 }; return t(p.parser.parse(n, p.xmlhttp)) }).catch(function (a) { if (null !== p.player) { var e = a.code || 900, t = a.adErrorCode || 1e4 + e; throw p.sendErrorEvent(a.message, e, t, o) } }).then(function (r) { if (null === p.player) return null; if (0 === r.length) throw p.sendErrorEvent("No ads", 303, 10303, o); var d = r.filter(function (a) { return !a.sequence }).map(function (a) { return a._currentTag = o, a }); p.loadedAds = p.wrapperOptions.allowMultipleAds ? r : d, p.options.wrapper = p.options.wrapper || [], p.options.adsystem && p.options.wrapper.push(p.options.adsystem), p.options.adsystem = p.loadedAds[0].adsystem; var t = []; return r.forEach(function (n, e) { if (n.wrappedURI) { if (!1 === p.wrapperOptions.followAdditionalWrappers) return; p.options.wrappedTags = p.options.wrappedTags || [p._scheduledAd._currentTag], p.options.wrappedTags.push(n.wrappedURI); var a = new l(p._scheduledAd, p.player, p.options, { fallbackOnNoAd: n.fallbackOnNoAd, allowMultipleAds: n.allowMultipleAds, followAdditionalWrappers: n.followAdditionalWrappers }, p.debugTrackFn).load(n.wrappedURI).then(function (e) { var d, t, l, c = (d = n, t = e.allAds(), l = [], t.forEach(function (a) { var n, o; d.companions && (a.companions = (a.companions ? a.companions : []).concat(d.companions)), d.trackers && (a.trackers = (n = a.trackers, o = d.trackers, n = n || {}, Object.keys(o).forEach(function (a) { var e = o[a]; n[a] = n[a] ? n[a].concat(e) : e }), n)), d.sequence && (a.sequence = d.sequence), d._currentTag && (a._currentTag = d._currentTag), l.push(a) }), l), s = p.loadedAds.indexOf(n); Array.prototype.splice.apply(p.loadedAds, [s, 1].concat(c)) }).catch(function (t) { var r = p.sendAdpodErrorEvent(t, n, e), a = n.fallbackOnNoAd && n.sequence && d.length, i = p.loadedAds.indexOf(n); if (a) return n.loadError = r, void t.vloader.destroy(); if (p.loadedAds.splice(i, 1), t.vloader.destroy(), "adPodError" !== r.type) throw r; p.trigger("adPodError", r) }); t.push(a) } else p.options.wrapper.length && (n.wrapper = p.options.wrapper, n.wrappedTags = p.options.wrappedTags) }), Promise.all(t) }).then(function () { if (null === p.player) return null; var a = p.loadedAds.filter(function (a) { return !a.sequence }); p.loadedAds.forEach(function (e, t) { if (e.loadError) if (a.length) { var d = p.loadedAds[t + 1], r = d && !d.sequence ? d : a[0]; p.loadedAds[t] = y({}, r, { sequence: e.sequence }) } else p.trigger("adPodError", e.loadError) }); var r = p.loadedAds.slice(0), e = r.length; r.forEach(function (a) { a.media && a.media.length || r.length-- }); var t = r.length !== e; if (0 === e || t) throw p.sendErrorEvent("Ad Tag Empty", 101, 10101, p._history[p._history.length - 1]); return p }) } }, { key: "ajaxError", value: function (d, e) { if (this.player.getAdBlock()) return this.sendErrorEvent("Ad playback blocked by an ad blocker", 900, 60003, e); var t = d.code; if (601 === t || 602 === t) return this.sendErrorEvent("Invalid XML", 100, 10100, e); var i = this.options.wrappedTags && this.options.wrappedTags.length, r = i ? 301 : 900, n = i ? 10301 : 60006; return this.sendErrorEvent(d.message || "Error loading file", r, n, e) } }, { key: "firstUrl", value: function () { return this._history && this._history.length ? this._history[0] : "" } }, { key: "sendAdpodErrorEvent", value: function (d, e, t) { var i = d.message, r = d.code, n = d.adErrorCode, a = d.url; if (1 === this.loadedAds.length) return this.sendErrorEvent(i, r, n, a, t); var s = { message: i, code: r, adErrorCode: n, podIndex: t, vloader: this, tag: this.firstUrl() || a, type: "adPodError" }; return this.trackError(s, e), this.wrappedTags = a, s } }, { key: "sendErrorEvent", value: function (d, e, t, i, r) { var n = { message: d, code: e, adErrorCode: t, podIndex: r, vloader: this, tag: this.firstUrl() || i, adsystem: this.options.adsystem || "" }; return this.options.wrappedTags && (n.wrapperAdSystem = this.options.wrapper || "", n.wrappedTags = this.options.wrappedTags), this.trackError(n), n } }, { key: "trackError", value: function (a, e) { var t = a.vloader.allAds(); if (t && t.length) { var d = e || t[0]; if (d) { var r = d.trackers; r && r.error && new de(d, r, this.debugTrackFn, this.player, this.options.trackingFilter).error(a.code) } } } }]), l }(), xe = "USD", je = "3.0.0", Le = "dfp", Me = "jwp", Ve = "jwpspotx", Be = "jwpdfp", Oe = "APS", He = "Index", De = "OpenRTB", Fe = "SpotX", Ne = (g(pe = {}, [Le], [Oe, "FAN", He, De, Fe]), g(pe, [Me], ["FAN", De, Fe]), g(pe, [Be], ["FAN", De, Fe]), g(pe, [Ve], [Fe]), pe), Ue = (g(ce = {}, ["EMX"], { endpoint: "https://hbint.emxdgt.com" }), g(ce, ["PubMatic"], { endpoint: "https://openbid.pubmatic.com/translator" }), g(ce, ["Telaria"], { endpoint: "https://jwplayer.eb.tremorhub.com/ad/rtb/jwp", preflight: !0 }), g(ce, ["MediaGrid"], { endpoint: "https://grid.bidswitch.net/jw_bid" }), ce), Xe = { BID_WON: 0, BID_BELOW_AUCTION_FLOOR: 100, LOST_TO_HIGHER_BID: 102 }, Qe = "bid", We = "error", ze = "invalid", Ke = "noBid", Ye = (g(me = {}, [Ke], 0), g(me, [Qe], 1), g(me, ["timeout"], 2), g(me, [ze], 3), g(me, ["abort"], 4), g(me, [We], 5), me), Ze = { 0: 500, 400: 501, 500: 503, 597: 502 }, ea = [{ message: "SpotX :: Unable to find ad", result: Ke, code: Ye[Ke] }, { message: "Error loading script", result: We, code: 6 }, { message: "Invalid options: 'slot' is required", code: 300 }, { message: "Invalid options: 'slot' must be part of DOM", code: 301 }, { message: "Invalid options: 'channel_id' is required.", code: 302 }, { message: "Invalid options: 'content_width' and 'content_height' are required when no 'video_slot' is provided.", code: 303 }, { message: "Invalid options: 'content_width' provided but 'content_height' is not.", code: 304 }, { message: "Invalid options: 'content_height' provided but 'content_width' is not.", code: 305 }, { message: "Invalid options: 'custom' must be an object.", code: 306 }, { message: "Invalid options: 'token' must be an object.", code: 307 }, { message: "Invalid options: 'ados' must be an object.", code: 308 }, { message: "Invalid options: 'contentPageUrl' must be a string.", code: 309 }, { message: "Invalid options: 'demand_source_timeout' must be a number.", code: 310 }, { message: "Invalid options: 'total_bid_timeout' must be a number.", code: 311 }], aa = [{ message: "Incorrect domain", code: 321 }, { message: "unsupported_platform", code: 322 }, { message: "Request_URL_noncompliant", code: 323 }, { message: "Application not authorised for header bidding", code: 324 }, { message: "pageurl is required", code: 325 }, { message: "adformats", code: 326 }], ta = Date.now || function () { return new Date().getTime() }, ra = function (a) { var e = a.autoplay, t = a.mute, d = a.autoplayAdsMuted; if (e) { var r = t || d; return "viewable" === e ? r ? 6 : 5 : r ? 2 : 1 } return t ? 4 : 3 }, da = function (a, e) { return a.replace(/\$\{AUCTION_ID\}/g, e.id).replace(/\$\{AUCTION_BID_ID\}/g, e.bid || "").replace(/\$\{AUCTION_IMP_ID\}/g, e.imp).replace(/\$\{AUCTION_SEAT_ID\}/g, e.seat || "").replace(/\$\{AUCTION_AD_ID\}/g, e.ad || "").replace(/\$\{AUCTION_CURRENCY\}/g, e.cur) }, ia = function (d, e, t) { var i = t ? t.priceInCents : "", r = e.priceInCents ? i / e.priceInCents : "", n = Xe[t ? "LOST_TO_HIGHER_BID" : "BID_BELOW_AUCTION_FLOOR"]; return d.replace(/\$\{AUCTION_PRICE\}/g, i / 100).replace(/\$\{AUCTION_MBR\}/g, r).replace(/\$\{AUCTION_LOSS\}/g, e.winner ? Xe.BID_WON : n) }, na = null, oa = null, sa = null, la = null, pa = (g(ye = {}, [Oe], { requestBids: function (a, e, t, d) { return a.id && a.slotID ? z(d).then(function (t) { return t.init({ id: a.pubId, adServer: a.adServer }), new Promise(function (d) { t.fetchBids({ slots: [{ slotID: a.slotID }], timeout: e.bidTimeout }, d) }) }).then(function (t) { return t && t[0] && t[0].slotID === a.slotID ? { result: Qe, tag: e.tag, custParams: { amznbid: t[0].amznbid, amzniid: t[0].amzniid } } : { result: Ke } }).catch(function (a) { return { result: We, message: "Amazon header bidding failed: ".concat(a) } }) : Promise.resolve({ result: ze }) } }), g(ye, ["FAN"], { requestBids: function (d, m, o, e) { var t = d.id, n = e.getURLParts(), a = function (a, e, t, d) { return ["https://an.facebook.com/v2/placementbid.json?&placementids[]=".concat(a), "&playerwidth=".concat(e), "&playerheight=".concat(t), "&adformats[]=".concat("video"), "&SDK[]=".concat(je), "&pageurl=".concat(encodeURIComponent(d.url)), "$random=".concat(Math.random() * Math.pow(10, 18))].join("") }(t, m.playerWidth, m.playerHeight, n); return function (a, e, t, d) { return !!d && (a === Le || e && t === xe) }(m.mediationLayerAdServer, m.floorPriceCents, m.floorPriceCurrency || xe, a) ? new Promise(function (r) { var e = new XMLHttpRequest; e.onreadystatechange = function () { 4 === this.readyState && (r(this), e = null) }, e.open("GET", a), e.withCredentials = !0, e.send(null), o.then(function () { e && (e.abort(), e = null) }) }).then(function (a) { if (200 !== a.status) return { result: We, message: "Invalid response (status ".concat(a.status, ")") }; var g, e, y = JSON.parse(a.responseText), s = y.errors, o = y.request_id; if (s && s.length) return { result: ze, code: (g = s[0], e = aa.filter(function (a) { return 0 <= g.indexOf(a.message) })[0], e ? e.code : 320), requestId: o }; var l = y.bids; if (!l || !l[t] || !l[t][0]) return { result: Ke, requestId: o }; var d = l[t][0], u = d.bid_price_cents, c = d.bid_id; if (m.mediationLayerAdServer === Le || m.mediationLayerAdServer === Be) return { result: Qe, tag: m.tag, custParams: { jwFANBidPrice: q(m.buckets, u / 100).toFixed(2), jwFANBidID: c }, requestId: o }; var v = { result: Qe, priceInCents: u, priceCurrency: d.bid_price_currency, requestId: o }; return u >= m.floorPriceCents && (v.tag = function (a, e, t, d, r) { return ["https://an.facebook.com/v1/instream/vast.xml?placementid=".concat(a), "&playerwidth=".concat(t), "&playerheight=".concat(d), "&SDK[]=".concat(je), "&bidid=".concat(e), "&pageurl=".concat(encodeURIComponent(r.url))].join("") }(t, c, m.playerWidth, m.playerHeight, n)), v }).catch(function (a) { return { result: We, message: "FAN header bidding failed: ".concat(a) } }) : Promise.resolve({ result: ze }) } }), g(ye, [He], { requestBids: function (a, d, e, t) { if (!a.id && !a.script) return Promise.resolve({ result: ze }); var r = y({ videoCommonArgs: { protocols: [2, 3, 5, 6], mimes: ["video/mp4", "video/webm", "application/javascript"], apiList: [1, 2] }, siteID: a.id }, a); return se(a.script, t).then(function (a) { return new Promise(function (n) { a.deferQueue = a.deferQueue || [], a.deferQueue.push(function () { a.solicitIndexVideoAds(d.tag, function (a, e) { n({ updatedTag: a, indexTargeting: e }) }, r) }) }) }).then(function (a) { var e = a.indexTargeting; return void 0 === e ? { result: Ke } : { result: Qe, tag: d.tag, custParams: e } }).catch(function (a) { return { result: We, message: "Index Exchange header bidding failed: ".concat(a) } }) } }), g(ye, [De], { postAuctionHandler: function (a, e) { if ((!e || e.winner) && a.result === Qe) { a.adm && (a.adm = ia(a.adm, a, e)); var t = a.winner ? a.custom.nurl : a.custom.lurl; if (t) if (a.winner && !a.adm) a.tag = ia(t, a, e); else { var d = new XMLHttpRequest; d.open("POST", ia(t, a, e)); var r = Ue[a.name]; r && r.preflight && d.setRequestHeader("x-openrtb-version", "2.5"), d.withCredentials = !0, d.send(null) } } return delete a.custom, a }, requestBids: function (n, e, p, t) { var r = Ue[n.name]; if (!r || !n.id || !n.pubid) return Promise.resolve({ result: ze }); var a, i, m = t.getURLParts(), y = { id: e.adPlayId, imp: [{ id: "1", displaymanager: "jwplayer", tagid: n.id, video: { mimes: (a = ["video/mp4", "video/ogg", "video/webm", "video/aac", "application/vnd.apple.mpegurl"], i = document.createElement("video"), a.filter(function (a) { return i.canPlayType(a) })).concat("application/javascript"), minduration: 3, maxduration: 300, protocols: [1, 2, 3, 7, 4, 5, 6, 8], w: e.playerWidth, h: e.playerHeight, startdelay: N(e.offset), placement: e.placement, linearity: 1, playbackmethod: [ra(e)], api: [1, 2] }, bidfloorcur: e.floorPriceCurrency, secure: "https:" === window.location.protocol ? 1 : 0 }], site: { domain: m.domain, page: m.url, ref: m.referrer, publisher: { id: n.pubid } }, device: { ua: window.navigator.userAgent, language: e.language.substring(0, 2) }, at: 1 }; if (void 0 !== e.skipoffset) { var d = y.imp[0].video; 0 <= e.skipoffset ? (d.skip = 1, d.skipmin = e.skipoffset + 2, d.skipafter = e.skipoffset) : d.skip = 0 } if (void 0 !== e.floorPriceCents && (y.imp[0].bidfloor = e.floorPriceCents / 100), (!0 === e.autoplay || "viewable" === e.autoplay && e.viewable) && (y.tmax = e.bidTimeout), Array.isArray(e.jwpseg)) { y.imp[0].video.ext = { jwpseg: e.jwpseg }; var l = e.jwpseg.map(function (a) { return { id: a, bidfloor: y.imp[0].bidfloor, bidfloorcur: y.imp[0].bidfloorcur } }); y.imp[0].pmp = { private_auction: 0, deals: l } } return t.getGDPRConsentData().then(function (a) { var e = a.gdprApplies, t = a.consentData; y.regs = { ext: { gdpr: e ? 1 : 0 } }, e && (y.user = { ext: { consent: t } }) }).then(function () { return new Promise(function (a) { var e = new XMLHttpRequest; e.onreadystatechange = function () { 4 === this.readyState && (a(this), e = null) }, e.open("POST", r.endpoint), r.preflight && (e.setRequestHeader("content-type", "application/json"), e.setRequestHeader("x-openrtb-version", "2.5")), e.withCredentials = !0, e.send(JSON.stringify(y)), p.then(function () { e && (e.abort(), e = null) }) }) }).then(function (r) { if (200 === r.status) { var d = JSON.parse(r.responseText), a = e.floorPriceCurrency || xe, i = d.cur ? d.cur.toUpperCase() : a; if (a !== i) return { result: We, code: 551 }; if (d.id === y.id && d.seatbid && d.seatbid.length) { var o, s = d.seatbid.reduce(function (a, e) { if (null === a && e && e.bid && e.bid.length) { var t = e.bid.filter(function (a) { return a.impid === y.imp[0].id }); if (t.length) return o = e.seat, t[0] } return a }, null); if (s) { if (s.adm) { var u = t.parseXML(s.adm); if (null === u) return { result: ze, code: 331 }; s.adm = Q(u.documentElement) } else if (!s.nurl) return { result: ze, code: 330 }; var c = { id: y.id, bid: d.bidid, imp: s.impid, seat: o, ad: s.adid, cur: i }, h = { result: Qe, priceInCents: 100 * s.price, priceCurrency: i, adm: s.adm ? da(s.adm, c) : null, custom: { exp: s.exp, nurl: s.nurl ? da(s.nurl, c) : null, lurl: s.lurl ? da(s.lurl, c) : null } }; if (e.mediationLayerAdServer === Le || e.mediationLayerAdServer === Be) { var p, k = t.genId(12), f = n.name.toLowerCase(); h.adm || (h.adm = function (a, e) { return "\n<VAST version=\"4.0\">\n    <Ad id=\"".concat(a, "\">\n        <Wrapper>\n            <AdSystem version=\"").concat("0.2.21", "\">JWP</AdSystem>\n            <VASTAdTagURI><![CDATA[").concat(e, "]]></VASTAdTagURI>\n        </Wrapper>\n    </Ad>\n</VAST>\n") }(k, h.custom.nurl)), h.cacheKey = k, h.custParams = (g(p = {}, ["vpb_".concat(f, "_key")], k), g(p, ["vpb_".concat(f, "_bid")], q(e.buckets, s.price).toFixed(2)), p) } return h } } return { result: Ke, code: void 0 === d.nbr ? Ye[Ke] : d.nbr + 400 } } return 204 === r.status ? { result: Ke } : 400 === r.status ? { result: ze } : { result: We } }) } }), g(ye, [Fe], { postAuctionHandler: function (a) { return a.scriptLoadingTime = ge, a }, requestBids: function (a, p, e, t) { if (!a.id) return Promise.resolve({ result: ze, code: 302 }); var r = { placement: p.placement, hide_skin: !0, no_vpaid_ads: !1 }, d = { channel_id: a.id, slot: p.playerContainer, content_width: p.playerWidth, content_height: p.playerHeight, player_vendor: "SpotXJW", player_vendor_id: p.playerId, ad_volume: p.adVolume, ad_mute: p.mute ? 1 : 0, autoplay: p.autoplay, blocked_autoplay_override_mode: p.autoplayAdsMuted, start_delay: N(p.offset) }, s = y(r, a.optionalParams, d); return a.passFloorPrice && p.floorPriceCents && (s.price_floor = p.floorPriceCents / 100), p.jwpseg && (s.custom = s.custom || {}, s.custom.jwpseg = p.jwpseg), Y(a.id, t).then(function (a) { var e = a.SpotX, t = a.loadingTime; ge = t; var d = new e.DirectAdOS(s), r = ta(); return d.getAdServerKVPs().then(function (a) { return { response: a, bidNetworkStartTime: r } }) }).then(function (a) { var e = a.response, t = a.bidNetworkStartTime, r = ta() - t, i = e.spotx_ad_key, n = { spotx_bid: q(p.buckets, e.spotx_bid).toFixed(2), spotx_ad_key: i }, o = 100 * parseFloat(e.spotx_bid), s = { result: Qe, priceInCents: o, custParams: n, scriptLoadingTime: ge, bidNetworkResponseTime: r }; return p.mediationLayerAdServer === Le ? s : y(s, { tag: ["file:" === document.location.protocol ? "https:" : "", "//search.spotxchange.com/ad/vast.html?key=", i].join(""), tagKey: i }) }).catch(function (a) { var e = ea.filter(function (e) { return e.message === a.message })[0]; return e ? { result: e.result || ze, code: e.code, scriptLoadingTime: ge } : { result: We, message: "SpotX header bidding failed: ".concat(a), scriptLoadingTime: ge } }) } }), ye), ca = function (d, e) { var t = e.parseXML(d.adm); if (null === t) return d.adm; for (var i = e.getTrackingPixelURLs(d.name, d.cacheKey), r = i.impression, n = i.error, a = t.querySelectorAll("InLine,Wrapper"), s = 0; s < a.length; s += 1)a[s].appendChild(D(t, "Impression", r, { id: d.cacheKey })), a[s].appendChild(D(t, "Error", n)); return Q(t) }, ua = function (d, l, a) { var p = d.filter(function (a) { return a && a.result === Qe && a.adm && a.cacheKey }); return 0 === p.length ? Promise.resolve({ bids: d }) : new Promise(function (r) { var e = p.map(function (t) { return { type: "xml", ttlseconds: (t.custom || {}).exp || 86400, value: a.getTrackingPixelURLs ? ca(t, a) : t.adm, key: t.cacheKey } }), d = ta(), i = function (e) { return function () { r({ result: e, code: this.status, time: 0 | ta() - d }), n = null } }, n = new XMLHttpRequest; n.onreadystatechange = function () { if (4 === this.readyState) { var a = 200 === this.status ? Qe : We; i(a)() } }, n.onabort = i("abort"), n.onerror = i(We), n.ontimeout = i("timeout"), n.open("POST", "https://vpb-cache.jwplayer.com/cache"), n.send(JSON.stringify({ puts: e })), l.then(function (a) { var e = a.result; n && (n.onabort = i(e), n.abort(), n = null) }) }).then(function (e) { var o = e.result, i = e.code, t = e.time; return p.forEach(function (a) { var e, d; a.result = o, a.result === We && (a.code = (e = i, d = 100 * parseInt(e / 100, 10), Ze[e] || Ze[d] || 599)) }), { bids: d, time: t } }) }, ma = function () { function a() { var t = this, e = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : {}, r = e.settings, i = void 0 === r ? {} : r, n = e.bidders, o = void 0 === n ? [] : n, s = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : {}, d = 2 < arguments.length ? arguments[2] : void 0; m(this, a), this.settings = function (a, e) { var t = y({ bidTimeout: 2e3, buckets: [], offset: "", playerContainer: e.container, playerHeight: e.height || 0, playerWidth: e.width || 0, tag: "", placement: 1 }, e, a); return Ne[t.mediationLayerAdServer] || (t.mediationLayerAdServer = Me), t.mediationLayerAdServer === Ve && (t.floorPriceCents = 1), t.floorPriceCurrency ? t.floorPriceCurrency = t.floorPriceCurrency.toUpperCase() : void 0 !== t.floorPriceCents && (t.floorPriceCurrency = xe), t }(i, s), this.utils = d, this.eventProps = {}; var l = 0 === N(this.settings.offset), c = this.settings.mediationLayerAdServer === Me || this.settings.mediationLayerAdServer === Be, u = Ne[this.settings.mediationLayerAdServer]; this.bidders = o.filter(function (a) { return (!isNaN(parseFloat(t.settings.floorPriceCents)) || !c) && -1 !== u.indexOf(a.type || a.name) && (l || a.type === De || a.name === Fe) }).map(function (a) { return a.name === Oe && a.id && a.slotID ? z(d) : a.name === He && (a.script || a.id) ? se(a.script, d) : a.name === Fe && a.id && Y(a.id, d), y(a, a.custom_params) }), this._bidRequest = null, this._currentTimeout = null, this._onCancelTrigger = null, this.onCancel = new Promise(function (a) { t._onCancelTrigger = a }) } return t(a, [{ key: "start", value: function () { var a, p, m, g, v, f, k, A, P, b, _, w; return this._bidRequest || (this._bidRequest = (a = { bidders: this.bidders, eventProps: this.eventProps, settings: this.settings, onCancel: this.onCancel, utils: this.utils }, p = a.bidders, m = a.eventProps, g = a.settings, v = a.onCancel, f = a.utils, k = g.mediationLayerAdServer === Le || g.mediationLayerAdServer === Be, A = g.mediationLayerAdServer === Me || g.mediationLayerAdServer === Be || g.mediationLayerAdServer === Ve, P = [], b = null, _ = null, w = p.map(function (a, r) { var e = ta(), t = Promise.race([pa[a.type || a.name].requestBids(a, g, v, f), v]).then(function (r) { var t = y({}, a, r, { timeForBidResponse: 0 | ta() - e }, A && { winner: !1 }); return A && t.result === Qe && t.priceInCents >= g.floorPriceCents && (null === _ || t.priceInCents > _.priceInCents) && (_ = t), t }).catch(function (r) { return y({}, a, { result: We, code: 550, message: r, timeForBidResponse: 0 | ta() - e }) }); return k && a.type === De ? (P[r] = t, t.then(function (a) { return null === b && (b = Promise.all(P).then(function (a) { return null === _ ? ua(a, v, f).then(function (a) { var e = a.bids, t = a.time; return m.timeForVPBCache = t, e }) : a })), b.then(function (a) { return a[r] }).catch(function (e) { return y(a, { result: We, code: 590, message: e }) }) })) : t }), Promise.all(w).then(function (a) { if (A && _) return _.winner = !0, { bidders: a, result: _ }; if (k) { var e = a.reduce(function (a, e) { return e.result === Qe ? y(a || {}, e.custParams) : a }, null), t = { bidders: a }; return null !== e && (t.result = { tag: g.tag, custParams: e }), t } return { bidders: a } }).then(function (a) { return a.bidders = a.bidders.map(function (e) { e.code = e.code || Ye[e.result]; var t = pa[e.type || e.name]; return "function" == typeof t.postAuctionHandler ? t.postAuctionHandler(e, a.result) : e }), y(p, a.bidders), a }))), this._bidRequest } }, { key: "stop", value: function () { var a = this; clearTimeout(this._currentTimeout), this._onCancelTrigger({ result: "abort" }), this._bidRequest = null, this._currentTimeout = null, this._onCancelTrigger = null, this.onCancel = new Promise(function (e) { a._onCancelTrigger = e }) } }, { key: "getEventObject", value: function () { var a = this.settings.mediationLayerAdServer, e = { bidsVersion: "0.2.21", mediationLayerAdServer: a, bidders: p(this.bidders), bidTimeout: this.settings.bidTimeout }; a !== Me && a !== Be || (e.floorPriceCents = +this.settings.floorPriceCents || 0); var t = this.settings.floorPriceCurrency; return t && (e.floorPriceCurrency = t), void 0 !== this.eventProps.timeForVPBCache && (e.timeForVPBCache = this.eventProps.timeForVPBCache), e } }, { key: "then", value: function (a) { return this._bidRequest ? this._bidRequest.then(a, a) : null } }, { key: "timeout", value: function () { clearTimeout(this._currentTimeout), this._currentTimeout = setTimeout(this._onCancelTrigger, this.settings.bidTimeout, { result: "timeout" }) } }]), a }(), ga = function () { }, ya = function () { function a(e, t, r, d, i) { m(this, a), this.config = d, this.item = r, this.params = i, this.player = e, this.schedule = t, this.vmapPromise = null, this._preRollPromise = null, this._midRollPromise = {}, this._postRollPromise = null, this.vmapTracker = null, this._events = [], this._vloaderQueue = [], this._staticAdsOffset = [], this.bids = [], this.bidsPromise = null, this.bidsResult = {}, this._debugTrackFn = d.debug && d.trackFn ? d.trackFn : null, y(this, e.Events) } return t(a, [{ key: "init", value: function (a, e) { var t = this, d = this.schedule; return d.isVMAP() && (this.vmapPromise = d._vmapPromise.catch(ga)), this.bidsPromise = this.vmapPromise || Promise.resolve(), null !== a && (this.bidsPromise = this.bidsPromise.then(function () { return t.isDestroyed() ? null : t._createBidsPromise(a, e) })), this.bidsPromise } }, { key: "_createBidsPromise", value: function (a, m) { var t = this, e = this.player, r = parseInt(a.bidOnBreaks, 10); return r = 0 < r ? r : 1 / 0, this.bids = this.schedule.getAllAds().slice(0, r).map(function (i) { var r = t.getAdIds(i), n = r.adBreakId, o = r.adPlayId, s = e.getConfig(), d = t.config.skipoffset, l = v(e, t.item), u = t.bidsResult[n] = new ma(a, { adPlayId: o, offset: i._offSet, width: e.getWidth(), height: e.getHeight(), container: e.getContainer(), playerId: e.id, autoplay: s.autostart, autoplayAdsMuted: t.config.autoplayadsmuted, adVolume: e.getVolume(), mute: e.getMute(), placement: c(s), skipoffset: null != d && 0 <= d ? d : -1, language: t.config.locale || e.getConfig().language, viewable: 1 === e.getViewable(), jwpseg: l }, { genId: e.utils.genId, getGDPRConsentData: be, getURLParts: f, parseXML: e.utils.parseXML, scriptloader: e.utils.scriptloader }); return u.start(), t.trigger("adBidRequest", k(t, i, y({ jwpseg: l }, m))), u.then(function (a) { var e = a.result; t.isDestroyed() || (e && !e.error && (e.adm ? (i.jwpseg = l, i._adXML = e.adm, i._adQueue && i._adQueue.length && i._adQueue.unshift(e.adm)) : e.tag && (i.jwpseg = l, i._adQueue = i._adQueue || [], i._adQueue.unshift(e.tag))), t.trigger("adBidResponse", k(t, i, m))) }), u }), Promise.all(this.bids) } }, { key: "getAdIds", value: function (d) { var e = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : {}, t = e.tagIndex, i = e.podIndex, r = d.adRequestIds && void 0 !== t ? d.adRequestIds[t] : null; if (!r) { var o = i || d._adPodIndex || 0, a = "p".concat(o, "w").concat(d._waterfallIndex || 0); r = "p0w0" === a ? d.adBreakId : d.adPlayIds[a] = d.adPlayIds[a] || this.player.utils.genId(12) } return { adBreakId: d.adBreakId, adPlayId: r } } }, { key: "loadPreRoll", value: function () { var a = this, e = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : {}; return null === this._preRollPromise && (this._preRollPromise = this.bidsPromise.then(function () { if (!a.isDestroyed()) { var t = a.schedule.getPreRoll(e.startTime); return t ? (t._position = "pre", a.loadAd(t, e)) : void 0 } })), this._preRollPromise } }, { key: "loadMidRollAtIndex", value: function (a, e) { var t = this; return this._midRollPromise[a] || (this._midRollPromise[a] = this.bidsPromise.then(function () { if (!t.isDestroyed()) { var d = t.schedule.getMidRollAtIndex(a); return d ? (d._position = "mid", t.loadAd(d, e)) : void 0 } })), this._midRollPromise[a] } }, { key: "loadPostRoll", value: function () { var a = this, e = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : {}; return null === this._postRollPromise && (this._postRollPromise = this.bidsPromise.then(function () { if (!a.isDestroyed()) { var t = a.schedule.getPostRoll(e.startTime); return t ? (t._position = "post", a.loadAd(t, e)) : void 0 } })), this._postRollPromise } }, { key: "loadAd", value: function (d) { var o = this, t = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : {}, e = this.player.utils; if (d._id = d._id || e.genId(12), this.config.preloadAds && (d._preload = t.preload || !1), d._vmapTracker = this.getVMAPTracker(d), d._adQueue || d._adXML || d._pod) { if (t.adBlock) throw u(this, { message: "Ad playback blocked by an ad blocker", adErrorCode: 600003 }, d, t); var r; if (d._pod) return this._loadPods(d, t); var i = function () { return o.isDestroyed() ? null : o._dispatchAdLoaded(d, t) }; return (r = d._adXML ? this._loadXML(d, t) : this._loadTag(d, t)).then(i).catch(ga), r.catch(i).catch(ga), r.catch(function (a) { return o.isDestroyed() ? null : o._vloaderWaterfall(a, t) }) } e.log("scheduled ad has no url or xml", d) } }, { key: "getVMAPTracker", value: function (a) { if (!a._vmapTracker) { var e = new de(a, a._trackers, this._debugTrackFn, this.player, this.config.trackingFilter); a._vmapTracker = this.vmapTracker = e } return a._vmapTracker } }, { key: "_loadTagUrl", value: function (a, e, t) { var d = this; return _(e, this.player, this.item, this.params, a).then(function (r) { "function" == typeof d._debugTrackFn && d._debugTrackFn({ type: "tagReplacement", data: { actualTag: r, originalTag: e } }); var i = d._createVastLoader(a, t), n = i.load(r); return t.isPodItemLoader ? t.tagIndex && (i.scheduledAd().adRequestIds[t.tagIndex] = d.player.utils.genId(12)) : a._currentTag = r, d._dispatchAdRequest(a, y({ tag: r }, t)), n }) } }, { key: "_loadTag", value: function (a, e) { var t = a._adQueue[a._waterfallIndex]; return this._loadTagUrl(a, t, e) } }, { key: "_loadPods", value: function (a, e) { var t = this; a.adRequestIds = []; var d = this._createVastLoader(a, e), r = a._pod.map(function (d, r) { var i = y({ tag: d, isPodItemLoader: !0, tagIndex: r }, e), n = t._loadTagUrl(a, d, i).catch(function (a) { return a.tagIndex = r, Promise.reject(a) }), o = function () { return t.isDestroyed() ? null : t._dispatchAdLoaded(a, i) }; return n.then(o).catch(ga), n.catch(o).catch(ga), n }); return d.podMultipleVastLoaders(r) } }, { key: "_loadXML", value: function (a, e) { var t; a._currentTag = a._currentTag || ((t = a._adXML).ownerDocument instanceof Document ? t.outerHTML || new XMLSerializer().serializeToString(t) : null) || a._adXML.toString(); var d = this._createVastLoader(a, e).parseXMLString(a._adXML, a._currentTag); return this._dispatchAdRequest(a, e), d } }, { key: "_dispatchAdRequest", value: function (a, e) { this.trigger("adRequest", k(this, a, y({ jwpseg: a.jwpseg }, e))) } }, { key: "_dispatchAdLoaded", value: function (a, e) { this.trigger("adLoaded", k(this, a, e)) } }, { key: "_handleVastLoadError", value: function (a, e, t) { var d = a.vloader; return this.removeVastLoader(d), this._getVloaderErrorObject(a, e, t) } }, { key: "_vloaderWaterfall", value: function (a, e) { var t = this._handleVastLoadError(a, null, e), d = a.vloader; return this.adWaterfall(d, t, e) } }, { key: "adWaterfall", value: function (a, e, t) { var d = a.scheduledAd(); if (this.schedule.canWaterfall(d)) return d.jwpseg = null, d._adXML = null, d._waterfallIndex += 1, this._enqueueAdEvent("adError", e, t), this.loadAd(d, t); throw e } }, { key: "addStaticOffset", value: function (a) { this._staticAdsOffset.push(a) } }, { key: "_createVastLoader", value: function (a) { var e = this, t = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : {}, d = this.config, i = new Re(a, this.player, y({ requestFilter: d.requestFilter, trackingFilter: d.trackingFilter }, t)); this._vloaderQueue.push(i); var n = 0; return i.on("adPodError", function (d) { n += 1; var r = e._getVloaderErrorObject(d, null, t); if (e._enqueueAdEvent("adError", r, t), !(i._scheduledAd._pod && i._scheduledAd._pod.length === n)) { var s = k(e, a, { podIndex: i._scheduledAd._adPodIndex, tagIndex: n }, t); e._enqueueAdEvent("adItem", s, t) } }), i } }, { key: "_getVloaderErrorObject", value: function (a, e, t) { a.wrapperAdSystem && a.wrapperAdSystem.length !== a.wrappedTags.length && (a.wrapperAdSystem.push(a.adsystem), a.adsystem = ""); var d = y({ adsystem: a.adsystem, wrapper: a.wrapperAdSystem, wrappedTags: a.wrappedTags }, a.vloader.scheduledAd()); return u(this, a, d, y({ tag: a.tag, tagIndex: a.tagIndex || e, podIndex: a.podIndex }, y({ jwpseg: d.jwpseg }, t))) } }, { key: "_enqueueAdEvent", value: function (a, e, t) { this._events.push({ type: a, event: e }), t.preload || this.dequeueAdEvents() } }, { key: "dequeueAdEvents", value: function () { var a = this; this._events.forEach(function (e) { var t = e.type, d = e.event; return a.trigger(t, d) }), this._events.splice(0) } }, { key: "removeVastLoader", value: function (a) { var e = this._vloaderQueue.indexOf(a); -1 !== e && (a.destroy(), this._vloaderQueue.splice(e, 1)) } }, { key: "isDestroyed", value: function () { return null === this.player } }, { key: "destroy", value: function () { this.bids.forEach(function (a) { return a.stop() }), this._vloaderQueue.forEach(function (a) { return a.destroy() }), this.player = null } }]), a }(), va = document.createElement("img"), fa = document.createElement("img"); va.src = fa.src = "data:image/svg+xml;charset=UTF-8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 64 64\"><circle cx=\"32\" cy=\"32\" r=\"32\" fill=\"%23191919\"/><line stroke=\"%23CCC\" stroke-width=\"6\" x1=\"32\" y1=\"20\" x2=\"32\" y2=\"44\"/><line stroke=\"%23CCC\" stroke-width=\"6\" x1=\"20\" y1=\"32\" x2=\"44\" y2=\"32\"/></svg>", va.className = "jw-vast-nonlinear-open-button", fa.className = "jw-vast-nonlinear-close-button"; var ha = function () { function a(e, t, r, d, i) { m(this, a), this.player = e, this.environment = e.getEnvironment(), this.div = d, this.staticURL = t, this.clickURL = r, this.loadTimer = -1, this.animationTimer = -1, this.banner = null, y(this, e.Events), this.banner = document.createElement("img"), this.banner.className = "jw-banner", this.banner.id = this.player.id + "_vast_static", this.div.appendChild(va), this.div.appendChild(this.banner), this.div.appendChild(fa), this.loadTimer = setTimeout(this.imageLoadError.bind(this), i), this.banner.onerror = this.imageLoadError.bind(this), this.banner.onload = this.onLoaded.bind(this), this.banner.src = this.staticURL } return t(a, [{ key: "onLoaded", value: function () { if (clearTimeout(this.loadTimer), 0 !== this.banner.naturalWidth) { this.removeBannerEventListeners(); var a = this.player.utils; a.addClass(this.div, "jw-vast-nonlinear-active"), a.style(fa, { bottom: this.banner.height - 8, left: this.banner.width }, !0), new a.UI(this.banner).on("click tap", this.sendClick.bind(this)), fa.onclick = fa.ontouchstart = this.collapse.bind(this), va.onclick = va.ontouchstart = this.expand.bind(this), this.trigger("play") } else this.imageLoadError() } }, { key: "imageLoadError", value: function () { clearTimeout(this.loadTimer), this.trigger("error"), this.removeBanner() } }, { key: "sendClick", value: function () { this.trigger("click") } }, { key: "collapse", value: function (a) { var e = this; a.preventDefault(), this.player.utils.addClass(this.div, "jw-vast-nonlinear-collapsed"), this.animationTimer = setTimeout(function () { e.remove(e.banner), e.remove(fa), e.animationTimer = -1 }, 250) } }, { key: "expand", value: function (a) { -1 === this.animationTimer && (a.preventDefault(), this.player.utils.removeClass(this.div, "jw-vast-nonlinear-collapsed"), this.div.appendChild(this.banner), this.div.appendChild(fa)) } }, { key: "remove", value: function (a) { this.div.contains(a) && this.div.removeChild(a) } }, { key: "removeBannerEventListeners", value: function () { this.banner.onload = this.banner.onerror = null } }, { key: "removeBanner", value: function () { this.removeBannerEventListeners(), this.remove(this.banner) } }, { key: "removeListeners", value: function () { clearTimeout(this.loadTimer), clearTimeout(this.animationTimer), fa.onclick = fa.ontouchstart = va.onclick = va.ontouchstart = null, this.off(), this.removeBannerEventListeners() } }, { key: "stop", value: function () { this.player.utils.removeClass(this.div, "jw-vast-nonlinear-active jw-vast-nonlinear-collapsed"), this.removeBanner(), this.remove(fa), this.remove(va) } }]), a }(), ka = function () { function a(e, t) { m(this, a), this.player = e, this.div = t, this.startTime = 0, this.minDur = 0, this.environment = e.getEnvironment(), y(this, e.Events), this.type = "static", e.on("time", this.dispatchTime, this) } return t(a, [{ key: "playAd", value: function (a, e, t, d, r) { this.minDur = this.player.utils.seconds(t), this.adTag = d, this.static && (this.static.removeListeners(), this.static.stop()), this.player.utils.addClass(this.div, "jw-vast-nonlinear"), this.static = new ha(this.player, a, e, this.div, r), this.static.on("play", this.startAd, this), this.static.on("click", this.clickHandler, this), this.static.on("error", this.errorHandler, this) } }, { key: "dispatchTime", value: function (a) { this.trigger("time", a) } }, { key: "startAd", value: function () { this.startTime = this.player.getPosition(), 0 < this.minDur && (0 === this.startTime ? this.on("time", this.startTimingAd, this) : this.on("time", this.timeAd, this)), this.sendEvent("play") } }, { key: "startTimingAd", value: function (a) { this.startTime = a.position, this.off("time", this.startTimingAd, this), this.on("time", this.timeAd, this) } }, { key: "timeAd", value: function (a) { a.position - this.startTime > this.minDur && (this.off("time", this.timeAd, this), this.stop()) } }, { key: "clickHandler", value: function () { this.sendEvent("click") } }, { key: "errorHandler", value: function () { this.sendEvent("error") } }, { key: "sendEvent", value: function (a, e) { (e = e || {}).tag = e.tag || this.adTag, this.trigger(a, e) } }, { key: "removeEvents", value: function () { this.off() } }, { key: "getState", value: function () { return "playing" } }, { key: "stop", value: function () { this.startTime && this.static && (this.startTime = 0, this.minDur = 0, this.off("time", this.startTimingAd, this), this.off("time", this.timeAd, this), this.static.removeListeners(), this.static.stop(), this.sendEvent("complete")) } }, { key: "pause", value: function () { } }]), a }(), Aa = function () { function a(e, t) { m(this, a), this.player = e, this.options = t, this.ignoreStartOnSeek = !1, this.reset(), t.timeBetweenAds && e.on({ adBreakStart: this.handleAdBreakStart, adSkipped: this.handleAdSkipped, adComplete: this.handleAdComplete, adBreakEnd: this.handleAdBreakEnd, destroyPlugin: this.destroy }, this) } return t(a, [{ key: "clearStartOnSeek", value: function () { this.ignoreStartOnSeek = !0 } }, { key: "sendAdBreakIgnored", value: function (a, e) { a && this.player.trigger("adBreakIgnored", function (a, e) { return { id: a._breakId, tag: a._adQueue && 0 < a._adQueue.length ? a._adQueue[0] : a._adXML, client: "vast", offset: a._offSet, timeSinceLastAd: e, type: "adBreakIgnored" } }(a, e)) } }, { key: "rulesAllowAdPlayback", value: function (a) { var e = this.options, t = 0 === e.frequency && 1 === a, d = a >= e.startOn && 0 == (a - e.startOn) % e.frequency; return t || d } }, { key: "handleAdBreakStart", value: function () { this.adSkipped = !1, this.adComplete = !1 } }, { key: "handleAdComplete", value: function () { this.adComplete = !0 } }, { key: "handleAdSkipped", value: function () { this.adSkipped = !0 } }, { key: "handleAdBreakEnd", value: function () { !this.adSkipped && this.adComplete && (this.recentCompletedAdTime = re()) } }, { key: "timeBetweenAdsAllowsAdPlayback", value: function (a) { var e = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : re(); if (this.options.timeBetweenAds) { var t = (e - this.recentCompletedAdTime) / 1e3; if (t < this.options.timeBetweenAds) return this.sendAdBreakIgnored(a, t), !1 } return !0 } }, { key: "reset", value: function () { this.ignoreStartOnSeek = !1, this.recentCompletedAdTime = 0 } }, { key: "destroy", value: function () { this.player.off(null, null, this) } }, { key: "timeBetweenAds", get: function () { return this.options.timeBetweenAds } }, { key: "startOnSeek", get: function () { return this.ignoreStartOnSeek ? null : this.options.startOnSeek } }]), a }(), Pa = {}, ba = function () { }; !function (a) { if (a && "undefined" != typeof window) { var e = document.createElement("style"); e.setAttribute("media", "screen"), e.innerHTML = a, document.head.appendChild(e) } }(".jwplayer.jw-flag-time-slider-above .jw-vpaid-non-linear{bottom:66px}.jwplayer.jw-breakpoint-7 .jw-vpaid-non-linear{bottom:132px}.jwplayer.jw-flag-user-inactive:not(.jw-state-paused) .jw-vpaid-non-linear{bottom:.5em}.jwplayer .jw-vpaid-non-linear{bottom:60px}.jwplayer .jw-vpaid-iframe{border:0;width:100%;height:100%;position:absolute;overflow:hidden}.jwplayer .jw-plugin-vast.jw-plugin{top:0;width:100%;pointer-events:none}.jwplayer .jw-plugin-vast.jw-plugin *{pointer-events:all}.jwplayer .jw-plugin-vast .jw-ad-icon-container{position:absolute;display:none;pointer-events:all;cursor:pointer}.jwplayer .jw-plugin-vast .jw-ad-icon-container.jw-ad-icon-active{display:block}.jwplayer .jw-plugin-vast .jw-ad-icon-container iframe{pointer-events:none;border:none;height:100%;width:100%;margin:0}.jw-plugin-vast.jw-vast-nonlinear-active .jw-banner{opacity:1}.jw-plugin-vast.jw-vast-nonlinear-active .jw-vast-nonlinear-close-button{margin:0 auto;opacity:.75}.jw-plugin-vast.jw-vast-nonlinear-active:hover .jw-vast-nonlinear-close-button{opacity:1}.jw-plugin-vast.jw-vast-nonlinear-collapsed .jw-vast-nonlinear-open-button{margin:0 auto;opacity:.5}.jw-plugin-vast.jw-vast-nonlinear-collapsed .jw-banner,.jw-plugin-vast.jw-vast-nonlinear-collapsed .jw-vast-nonlinear-close-button{opacity:0}.jw-plugin-vast.jw-vast-nonlinear-collapsed:hover .jw-vast-nonlinear-open-button{opacity:1}.jw-plugin-vast.jw-vast-nonlinear-collapsed:hover .jw-vast-nonlinear-close-button{opacity:0}.jw-plugin-vast .jw-vast-nonlinear-close-button,.jw-plugin-vast .jw-vast-nonlinear-open-button{position:absolute;right:0;bottom:0;left:0;display:block;margin:auto;width:18px;height:18px;cursor:pointer;opacity:0;transition:opacity .2s ease}.jw-plugin-vast .jw-vast-nonlinear-close-button{transform:rotate(45deg)}"), (window.jwplayerPluginJsonp || window.jwplayer().registerPlugin)("vast", "8.1", function (p, e, d) { function m(a) { A(); var r = I; Promise.resolve(a).then(function () { if (!r.isDestroyed()) return f(a), r.loadAd(a, { adBlock: pe }) }).then(function (a) { return r.isDestroyed() ? null : b(a, "external") }).catch(function (a) { return r.isDestroyed() ? null : E(a) }) } function f(e, t) { var d = I, r = d.getVMAPTracker(e); O.once("destroyed", function () { Z.clear("adBreakStart"), r.breakEnd(), p.trigger("adBreakEnd", k(d, e)), I === d && I.schedule.resetBreakIdByOffset(t) }), Z.tick("adBreakStart"), r.breakStart(); var i = k(d, e); p.trigger("adBreakStart", i), p.trigger("adItem", i) } function A() { O || (O = p.createInstream().init()).setText(null) } function t(t, d) { var r, i = 2 < arguments.length && void 0 !== arguments[2] ? arguments[2] : {}, s = function (a, e) { return Y.rulesAllowAdPlayback(e) ? a && a.adschedule ? me.getSchedule(a, Y) : te : ee }(t, d), o = new ya(p, s, t, e, de); return o.on((g(r = {}, ["adBidRequest"], function (e) { return p.trigger("adBidRequest", e) }), g(r, ["adBidResponse"], function (e) { return p.trigger("adBidResponse", e) }), g(r, ["adItem"], function (e) { return p.trigger("adItem", e) }), g(r, ["adRequest"], T), g(r, ["adLoaded"], n), g(r, ["adError"], C), r), j), s.isVMAP() && (i.requestTimeout = s.requestTimeout, i.creativeTimeout = s.creativeTimeout, s.load(p, t, de).then(function (a) { o.isDestroyed() || a.forEach(function (a) { C(u(o, a, null, i)) }) }).catch(function (a) { o.isDestroyed() || E(u(o, a, null, i)) })), o.init(c, i).then(function () { o.isDestroyed() || p.trigger("adSchedule", k(o, null, { schedule: s })) }), o } function P() { I && (I.schedule.reset(), I.off(null, null, j), I.destroy(), I = null), a(), w(), _(), Y.reset(), p.setCues([]), le = 0, ne = !1 } function b(e, a) { return (I.dequeueAdEvents(), e) ? ("nonlinear" === e.scheduledAd()._type && w(), function (o, t) { var e = o.scheduledAd(); 0 === e._waterfallIndex && _(), I.removeVastLoader(o); var r = new Promise(function (e, r) { var a = new _e(o, p, M, V, I, d, de); a.on("adPlayComplete", e), a.on("adError", r), a.on("adImpression", i), a.on("adPodError", C), a.init(O, t).catch(ba), L = O, O = null, oe.push(a) }), a = I; return r.then(function () { a.isDestroyed() || "nonlinear" === e._type || w() }).catch(function (r) { if (!a.isDestroyed()) return O = O || L, a.adWaterfall(o, r, { adBlock: pe }).then(function (r) { return a.isDestroyed() ? null : b(r, t) }) }) }(e, a)) : void w() } function a() { oe.forEach(function (a) { return a.destroy() }), oe.splice(0) } function i(e) { S(e) && (Z.tick("adImpression".concat(e.id)), e.timeLoading = Z.between("adBreakStart", "adImpression".concat(e.id))), p.trigger("adImpression", e) } function _() { oe.length && oe[oe.length - 1].clearNonlinear() } function w() { if (O || L) { var a = O || L; O = null, a.destroy() } L = null } function n(e) { var a = e.id; Z.tick("adLoaded".concat(a)), e.timeLoading = Z.between("adLoading".concat(a), "adLoaded".concat(a)), p.trigger("adLoaded", e) } function T(e) { p.trigger("adRequest", e), Z.tick("adLoading".concat(e.id)) } function E(t) { t && t.adErrorCode || (t = u(I, { message: "An unexpected ad error has occurred", sourceError: t })), I.dequeueAdEvents(), C(t), a(), w() } function C(e) { S(e) && (Z.tick("adError".concat(e.id)), e.timeLoading = Z.between("adBreakStart", "adError".concat(e.id))), I && I.vmapTracker && I.vmapTracker.error(e.code), (50004 === e.adErrorCode || 50901 === e.adErrorCode) && p.getAdBlock() && (pe = !0), p.trigger("adError", e) } function S(a) { return a.tag && (void 0 === a.podcount || 1 === a.sequence) } function R(e) { var a = e.getMidRolls(), t = []; a.length && a.forEach(function (a) { "nonlinear" !== a._type && t.push({ begin: a._offSet, text: de.cuetext }) }), p.addCues(t) } var x = p.getConfig(), r = x.key, s = p.getEnvironment(), o = e.debug && e.trackFn ? e.trackFn : null, j = this, c = null, l = e.bids && e.bids.settings ? e.bids.settings.mediationLayerAdServer || "jwp" : null; if ((l === "jwp" || l === "jwpspotx") && e.bids.bidders) { var v = e.bids.bidders; v.length && (c = y({}, e.bids, { bidders: v })) } var I, L, M, V, O, ae, de = {}, ne = !1, oe = [], Q = !1, se = 0, le = 0, pe = !1, ce = null, ue = !1, me = new Se(p.utils), Y = new Aa(p, me.getAdRules(e)), Z = new p.utils.Timer; this.version = "8.7.9", this.bidsVersion = "0.2.21"; var ee = new Ce(Y, p.utils), te = me.getSchedule(e, Y); te.isVMAP() && te.load(p, {}, de).catch(ba), y(this, p.Events), p.utils.addClass(d, "jw-plugin-vast"), p.on({ all: function (a, d) { a === "time" ? function (c) { if (!(Q || 0 === c.duration)) { var i = I.schedule.getNextMidrollIndex(le, c.position, c.duration); if (le = c.position, null !== i) { var r = I.schedule.getMidRollAtIndex(i); "nonlinear" !== r._type && (A(), f(r, i)); var n = I; n.loadMidRollAtIndex(i, { adBlock: pe }).then(function (a) { return n.isDestroyed() ? null : b(a) }).catch(function (a) { return n.isDestroyed() ? null : E(a) }) } else if (e.preloadAds) { var a = c.position + 5, s = I.schedule.peek(c.position, a, c.duration); if (null !== s && 0 <= s) I.loadMidRollAtIndex(s, { adBlock: pe, preload: !0 }).catch(ba); else if (-1 === s) { var o = re() + 1e3 * (c.duration - c.position); I.loadPostRoll({ adBlock: pe, preload: !0, startTime: o }).catch(ba) } else if (null === ce && a > c.duration) { var l = p.getPlaylistItem(p.getPlaylistIndex() + 1); ue = !l, (l || ae) && ((ce = t(l || ae, se + 1, { preload: !0 })).loadPreRoll({ adBlock: pe, preload: !0 }).catch(ba), ae = null) } } } }(d) : a === "beforeComplete" && function () { if (!Q) { var a = I.schedule.getPostRoll(); if (a) { "nonlinear" !== a._type && (A(), f(a, "post")); var r = I; r.loadPostRoll({ adBlock: pe }).then(function (a) { return r.isDestroyed() ? null : b(a) }).catch(function (a) { return r.isDestroyed() ? null : E(a) }) } } }() }, ready: function () { var a = this; M = new ka(p, d), V = new ve(o, s, { openLink: p.utils.openLink }), x.localization = p.getConfig().localization, (de = me.getOptParams(e, x.localization.advertising)).debugTrackFn = o, ie.catch(function (e) { P(), p.off(null, null, a), p.playAd = ba, C(u(null, { message: "Ad Error: ".concat(e.message), adErrorCode: 60002, id: "-1", tag: "" })) }) }, relatedReady: function () { if (e.preloadAds) { var a = p.getPlugin("related"); a && a.on("nextUp", function (a) { a && "discovery" === a.mode && (ae = a) }) } }, beforePlay: function (a) { if (!(Q || ne)) { ne = !0, I.bids.forEach(function (a) { return a.timeout() }); var t = (a || {}).startTime || p.getPosition(); le = t || le; var e = I.schedule.getPreRoll(t); if (e || I.vmapPromise) { (null !== I.vmapPromise || e && "nonlinear" !== e._type) && A(); var r = I; r.bidsPromise.then(function () { if (!r.isDestroyed()) { var a = r.schedule.getPreRoll(t); a && "nonlinear" !== a._type && f(a, "pre") } }), t ? "none" === Y.startOnSeek && (I._preRollPromise = null) : Y.clearStartOnSeek(), r.loadPreRoll({ adBlock: pe, startTime: t }).then(function (t) { var e = a && a.playReason ? a.playReason : "external"; return r.isDestroyed() ? null : b(t, e) }).catch(function (a) { return r.isDestroyed() ? null : E(a) }) } } }, cast: function (a) { Q = !!a.active }, play: function (a) { j.trigger("playing", a) }, playlistItem: function (r) { se += 1, P(); var d = p.getPlaylistItem(r.index); if (ce && d !== ce.item && !1 === ue && (ce.off(null, null, j), ce.destroy(), ce = null), I = ce || t(d, se), ce = null, I.schedule.isVMAP() ? I.vmapPromise.then(function () { I.isDestroyed() || R(I.schedule) }).catch(ba) : R(I.schedule), e.preloadAds && 1 === se) { var i = x.autostart; !1 === i || "viewable" === i && 0 === p.getViewable() ? I.loadPreRoll({ adBlock: pe, preload: !0 }).catch(ba) : p.once("autostartNotAllowed", function () { I.loadPreRoll({ adBlock: pe, preload: !0 }).catch(ba) }) } }, playlistComplete: P, complete: function () { _(), ne = !1 }, destroyPlugin: P }, this), p.pauseAd = function (a, r) { if (a = "boolean" != typeof a || a, oe.length) { var t = oe[oe.length - 1]; a ? t.pause(r || {}) : t.play(r || {}) } }, p.playAd = function (e) { var t; _(); var d = 0 === de.requestTimeout ? 1 / 0 : de.requestTimeout, r = 0 === de.creativeTimeout ? 1 / 0 : de.creativeTimeout; t = Array.isArray(e) ? e.slice(0) : [e]; var n = p.utils.genId, a = { _id: n(12), _adQueue: t, _waterfallIndex: 0, _adPodIndex: 0, adBreakId: n(12), _offset: 0, _position: h(p), requestTimeout: d || 5000, creativeTimeout: r || 15000 }; I ? m(a) : p.once("playlistItem", function () { return m(a) }) }, p.skipAd = function () { oe.length && oe[oe.length - 1].skip() }; var ie = function (a, e, d) { var t = Pa[e]; return t || (Pa[e] = new Promise(function (i, r) { !function (t) { var d = new a.key(e); if ("unlimited" === d.edition()) return t(); var r = [""]; "file:" === window.location.protocol && r.unshift("https:"), a.ajax(r.join(""), function (a) { t(a && a.response) }, function () { t() }, { timeout: 1e4, responseType: "json" }) }(function (n) { var e, o, l = n || {}; !0 === d.outstream ? (e = !1 !== l.canPlayOutstreamAds, o = "Outstream Ad Limit Reached") : (e = !1 !== l.canPlayAds, o = "Ad Limit Reached"), !1 === e ? r({ message: o }) : i({ message: "Can Play Ads" }) }) })) }(p.utils, r, e); ie.catch(ba), this.destroy = P }) }();